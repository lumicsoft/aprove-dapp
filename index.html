<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AiEarn Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        /* Custom CSS for vibrant look and feel */
        
        /* üü¢ 2. CSS ‡§µ‡•à‡§∞‡§ø‡§è‡§¨‡§≤ (Custom Properties) ‡§∏‡•á‡§ü ‡§ï‡§ø‡§è ‡§ó‡§è */
        :root {
            --tg-bg-color: #f0f2f5; /* Default fallback */
            --tg-text-color: #1f2937; /* Default fallback */
            --tg-hint-color: #9ca3af;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            /* Telegram ‡§ï‡•á ‡§•‡•Ä‡§Æ ‡§ï‡§≤‡§∞ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç */
            background-color: var(--tg-bg-color); 
            color: var(--tg-text-color); /* Darker text for contrast */
        }
        
        /* Tailwind classes ‡§ú‡•ã TG theme ‡§™‡§∞ ‡§®‡§ø‡§∞‡•ç‡§≠‡§∞ ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç ‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§¨‡§¶‡§≤‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è: */
        .text-gray-600 { color: var(--tg-hint-color); }
        
        .green-gradient-button {
            /* Stronger, more appealing gradient */
            background: linear-gradient(135deg, #10B981 0%, #34D399 100%);
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(16, 185, 129, 0.4);
        }
        .green-gradient-button:hover {
            opacity: 0.95;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(16, 185, 129, 0.6);
        }
        .pink-gradient-button {
            /* Vibrant pink/red gradient */
            background: linear-gradient(135deg, #FF3D69 0%, #FF6B8A 100%);
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(255, 61, 105, 0.4);
        }
        .pink-gradient-button:hover {
            opacity: 0.95;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(255, 61, 105, 0.6);
        }
        .orange-gradient-button {
            background: linear-gradient(135deg, #F97316 0%, #FBBF24 100%);
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(249, 115, 22, 0.4);
        }
        .orange-gradient-button:hover {
            opacity: 0.95;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(249, 115, 22, 0.6);
        }
        .blue-gradient-button {
            background: linear-gradient(135deg, #3B82F6 0%, #60A5FA 100%);
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(59, 130, 246, 0.4);
        }
        .blue-gradient-button:hover {
            opacity: 0.95;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(59, 130, 246, 0.6);
        }
        .roi-table-header {
            background-color: #e5e7eb;
        }
        .hot-badge {
            position: absolute;
            top: 0;
            right: 0;
            background-color: #EF4444;
            color: white;
            font-size: 0.75rem;
            font-weight: bold;
            padding: 0.25rem 1.5rem;
            transform: rotate(45deg) translate(25%, -25%);
            transform-origin: 100% 0;
            width: 120px;
            text-align: center;
        }
        .input-usdt::-webkit-outer-spin-button,
        .input-usdt::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .input-usdt {
            -moz-appearance: textfield; /* Firefox */
        }
        .view {
            animation: fadeIn 0.3s ease-in-out;
        }
        .hidden-view {
            display: none;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .pagination-button {
            padding: 0.5rem 0.75rem;
            margin: 0 0.25rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.2s;
        }
        .pagination-button.active {
            background-color: #3B82F6;
            color: white;
            box-shadow: 0 2px 5px rgba(59, 130, 246, 0.5);
        }
        .pagination-button:not(.active):hover {
            background-color: #E5E7EB;
        }
        .trading-status-th {
            background-color: #1f2937;
            color: white;
        }
        /* Telegram Web App Styles */
        .bg-white { background-color: var(--tg-bg-color); }
        .bg-gray-800 { background-color: #1f2937; } /* Keep dark card dark */
        .shadow-md, .shadow-2xl { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1); }
        
    </style>
</head>
<body class="min-h-screen">

    <header id="header" class="bg-white p-4 shadow-md sticky top-0 z-20"></header>

    <div id="appContainer" class="max-w-lg mx-auto p-4 space-y-5 pb-24">
        
        <section id="dashboardView" data-view="dashboard" class="view space-y-5">
            
            <div class="flex justify-between items-center text-sm font-medium">
                <span class="text-gray-600 font-semibold">You Earned:</span>
                <div class="flex items-center space-x-3">
                    <span class="bg-white rounded-full px-4 py-1.5 text-green-600 border border-green-300 shadow-md flex items-center">
                        <i data-lucide="gem" class="w-4 h-4 mr-1.5 text-green-500"></i> <span class="font-bold text-base">0.0295</span>
                    </span>
                    <button onclick="navigateTo('withdrawalView')" class="flex items-center bg-orange-500 text-white rounded-full px-4 py-1.5 text-sm font-bold hover:bg-orange-600 transition shadow-md">
                        Withdraw <i data-lucide="arrow-right" class="w-4 h-4 ml-1"></i>
                    </button>
                    <button onclick="console.log('Support')" class="text-blue-500 hover:text-blue-700 p-1 rounded-full">
                        <i data-lucide="send" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>

            <div class="bg-gray-800 rounded-xl p-3 flex justify-between items-center shadow-2xl border-l-4 border-green-500">
                <div class="flex items-center">
                    <i data-lucide="zap" class="w-6 h-6 text-yellow-400 mr-2"></i>
                    <span class="text-white text-base font-semibold">WEEKEND EARN FAST</span>
                </div>
                <div class="flex items-center">
                    <span class="text-green-400 text-xl font-extrabold mr-2">Earn ‚¨Ü30%</span>
                    <span class="text-white text-sm">in 48h</span>
                </div>
                <button id="weekendDashboardButton" onclick="navigateTo('weekendEarnView')" class="bg-yellow-400 text-gray-900 text-xs font-extrabold px-3 py-1.5 rounded-full hover:bg-yellow-500 transition">
                    LET'S GO
                </button>
            </div>

            <div class="bg-white p-6 rounded-3xl shadow-2xl text-center border border-gray-100">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center">
                        <span class="text-gray-600 font-semibold text-lg">TP (Trade Power)</span>
                        <i data-lucide="info" class="w-4 h-4 text-gray-400 ml-1 cursor-pointer"></i>
                    </div>
                    <i data-lucide="refresh-ccw" class="w-5 h-5 text-blue-500 cursor-pointer hover:rotate-180 transition duration-500"></i>
                </div>

                <div class="flex items-center justify-center mb-6 py-4">
                    <span class="text-8xl font-black text-gray-900 tracking-tighter">0.5</span>
                </div>

                <p class="text-sm mb-4 text-gray-700 flex items-center justify-center">
                    <span class="text-gray-500 mr-2">Daily Earn:</span>
                    <i data-lucide="dollar-sign" class="w-4 h-4 text-green-600"></i>
                    <span class="font-bold text-green-600 ml-0.5">$0.028</span>
                    <button onclick="navigateTo('dailyEarningHistoryView')" class="text-xs text-gray-500 ml-3 hover:text-gray-700 flex items-center bg-gray-100 rounded-full px-2 py-1 shadow-inner">
                        <i data-lucide="history" class="w-4 h-4 text-gray-400 mr-1"></i> History
                    </button>
                </p>

                <div class="flex justify-center mb-8">
                    <div id="settlement-timer" class="bg-purple-50 text-purple-700 font-bold rounded-full px-5 py-2 text-md shadow-inner border border-purple-200">
                        Settlement time: 00h 00m 00s
                    </div>
                </div>

                <div class="flex space-x-4 justify-center">
                    <button onclick="navigateTo('buyTPView')" class="green-gradient-button flex-1 py-4 px-6 rounded-xl text-white font-extrabold text-lg flex items-center justify-center max-w-[200px]">
                        <i data-lucide="trending-up" class="w-5 h-5 mr-2"></i> Buy TP
                    </button>
                    <button onclick="navigateTo('referEarnView')" class="pink-gradient-button flex-1 py-4 px-6 rounded-xl text-white font-extrabold text-lg flex items-center justify-center max-w-[200px]">
                        <span class="text-yellow-300 text-2xl font-black mr-1">$10</span> Refer & Earn
                    </button>
                </div>
            </div>

            <div class="bg-white p-6 pt-10 rounded-3xl shadow-2xl mt-6 relative overflow-hidden border border-gray-100">
                <div class="hot-badge shadow-lg">HOT</div>
                <h2 class="text-xl font-bold mb-4 text-gray-800">Return on Investment in AiEarn</h2>
                
                <table class="w-full text-left border-collapse rounded-lg overflow-hidden">
                    <thead>
                        <tr>
                            <th class="py-3 px-4 roi-table-header text-sm font-bold text-gray-700">TP Purchased (USDT)</th>
                            <th class="py-3 px-4 roi-table-header text-sm font-bold text-gray-700 text-right">Daily Return Rate</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-b border-gray-100 hover:bg-gray-50">
                            <td class="py-3 px-4 text-gray-600 font-medium">‚â• $0</td>
                            <td class="py-3 px-4 text-right font-semibold text-green-500" data-rate="0.055">5.5%</td>
                        </tr>
                        <tr class="border-b border-gray-100 hover:bg-gray-50">
                            <td class="py-3 px-4 text-gray-600 font-medium">‚â• $20</td>
                            <td class="py-3 px-4 text-right font-semibold text-green-500" data-rate="0.060">6%</td>
                        </tr>
                        <tr class="border-b border-gray-200 bg-red-50/70">
                            <td class="py-4 px-4 text-gray-700 font-bold">
                                ‚â• $300 <span class="text-red-500 text-lg ml-1">üî•üî•üî•</span>
                            </td>
                            <td class="py-4 px-4 text-right font-extrabold text-green-700 text-lg" data-rate="0.065">6.5%</td>
                        </tr>
                        <tr class="bg-red-100/70">
                            <td class="py-4 px-4 text-gray-700 font-bold">
                                ‚â• $3000-10000 <span class="text-red-600 text-lg ml-1">üî•</span>
                            </td>
                            <td class="py-4 px-4 text-right font-extrabold text-green-700 text-lg" data-rate="0.070">7%</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="flex space-x-4 pt-4">
                 <button onclick="navigateTo('aiTradingStatusView')" class="blue-gradient-button flex-1 py-3 px-4 rounded-xl text-white font-bold text-sm flex items-center justify-center shadow-lg">
                    <i data-lucide="activity" class="w-4 h-4 mr-2"></i> AI Trading Status
                </button>
                <button onclick="navigateTo('myTradePowerView')" class="orange-gradient-button flex-1 py-3 px-4 rounded-xl text-white font-bold text-sm flex items-center justify-center shadow-lg">
                    <i data-lucide="layers-3d" class="w-4 h-4 mr-2"></i> My Trade Power
                </button>
            </div>
            
        </section>

        <section id="weekendEarnView" data-view="weekend-earn" class="hidden-view view bg-white p-6 rounded-3xl shadow-2xl">
            <h2 class="text-2xl font-bold text-gray-800 flex items-center mb-6 border-b pb-3">
                <i data-lucide="zap" class="w-6 h-6 mr-2 text-yellow-500"></i> WEEKEND EARN FAST
            </h2>
            
            <p class="text-lg font-bold text-gray-700 mb-4 bg-yellow-100 p-3 rounded-lg border-l-4 border-yellow-500">
                ‚ö° Earn 30% in 48 Hours! (Fixed Rate)
            </p>

            <button onclick="navigateTo('weekendEarnHistoryView')" class="w-full text-sm font-semibold text-blue-600 hover:text-blue-800 mb-6 flex items-center justify-center py-2 bg-blue-50 rounded-lg shadow-inner">
                <i data-lucide="history" class="w-4 h-4 mr-2"></i> View Weekend Earn History 
            </button>


            <p id="weekendRestrictionText" class="text-gray-600 mb-6">Invest for a short-term, high-return opportunity. (Minimum 100 USDT, **Once per week**)</p>

            <div class="mb-8">
                <label for="weekendAmount" class="block text-sm font-semibold text-gray-700 mb-2">Investment Amount (USDT)</label>
                <div class="relative rounded-xl shadow-inner border border-gray-200">
                    <input type="number" id="weekendAmount" placeholder="Min. 100 USDT" 
                           min="100" step="0.01" value=""
                           oninput="calculateWeekendReturn(this.value)"
                           class="input-usdt w-full p-4 pr-16 text-2xl font-bold text-gray-900 border-none bg-transparent focus:ring-yellow-500 focus:border-yellow-500 rounded-xl"
                           required>
                    <span class="absolute right-0 top-0 bottom-0 flex items-center pr-4 text-xl font-extrabold text-yellow-600">USDT</span>
                </div>
            </div>

            <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-xl mb-8 shadow-inner">
                <p class="text-sm font-medium text-yellow-700 flex items-center mb-1">
                    <i data-lucide="trending-up" class="w-4 h-4 mr-2"></i> Total Return Rate:
                    <span id="weekendRateDisplay" class="font-extrabold text-yellow-800 ml-1">30%</span>
                </p>
                <p class="text-lg font-bold text-yellow-900 flex items-center">
                    <i data-lucide="gem" class="w-5 h-5 mr-2"></i> Est. 48h Earnings: 
                    <span id="weekendReturnAmount" class="ml-1 text-2xl">0.00 USDT</span>
                </p>
            </div>

            <button onclick="simulateWeekendGateway()" id="weekendBuyButton" disabled
                    class="w-full orange-gradient-button py-4 rounded-xl text-white font-extrabold text-lg shadow-lg opacity-50 cursor-not-allowed">
                <i data-lucide="lock" class="w-5 h-5 mr-2 inline-block"></i> Invest Now (Min 100 USDT)
            </button>
        </section>

        <section id="weekendEarnHistoryView" data-view="weekend-earn-history" class="hidden-view view bg-white p-6 rounded-3xl shadow-2xl">
            <h2 class="text-2xl font-bold text-gray-800 flex items-center mb-6 border-b pb-3">
                <i data-lucide="history" class="w-6 h-6 mr-2 text-yellow-500"></i> Weekend Earn History 
            </h2>
            <div class="overflow-x-auto rounded-xl shadow-md border border-gray-200">
                <table class="min-w-full text-left border-collapse">
                    <thead class="bg-gray-100 sticky top-0">
                        <tr>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700">Date/Time </th>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700 text-right">Invested </th>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700 text-right">Return </th>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700 text-center">Status</th>
                        </tr>
                    </thead>
                    <tbody id="weekendEarnHistoryBody">
                        </tbody>
                </table>
            </div>
            <div id="weekendEarnHistoryPagination" class="flex justify-center items-center mt-6"></div>
        </section>
        
        <section id="buyTPView" data-view="buy-tp" class="hidden-view view bg-white p-6 rounded-3xl shadow-2xl">
            <h2 class="text-2xl font-bold text-gray-800 flex items-center mb-6 border-b pb-3">
                <i data-lucide="wallet" class="w-6 h-6 mr-2 text-green-500"></i> TP Investment Portal
            </h2>
            
            <button onclick="navigateTo('buyTPHistoryView')" class="w-full text-sm font-semibold text-blue-600 hover:text-blue-800 mb-6 flex items-center justify-center py-2 bg-blue-50 rounded-lg shadow-inner">
                <i data-lucide="layers" class="w-4 h-4 mr-2"></i> View TP Purchase History 
            </button>


            <p class="text-gray-600 mb-6">Deposit USDT to increase your Trade Power and maximize your Daily ROI.</p>

            <div class="mb-8">
                <label for="usdtAmount" class="block text-sm font-semibold text-gray-700 mb-2">Investment Amount (USDT)</label>
                <div class="relative rounded-xl shadow-inner border border-gray-200">
                    <input type="number" id="usdtAmount" placeholder="Min. 10 USDT" 
                           min="10" step="0.01" value=""
                           oninput="calculateReturn(this.value)"
                           class="input-usdt w-full p-4 pr-16 text-2xl font-bold text-gray-900 border-none bg-transparent focus:ring-green-500 focus:border-green-500 rounded-xl"
                           required>
                    <span class="absolute right-0 top-0 bottom-0 flex items-center pr-4 text-xl font-extrabold text-green-600">USDT</span>
                </div>
            </div>

            <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded-xl mb-8 shadow-inner">
                <p class="text-sm font-medium text-green-700 flex items-center mb-1">
                    <i data-lucide="zap" class="w-4 h-4 mr-2"></i> Your Daily Return Rate:
                    <span id="dailyRateDisplay" class="font-extrabold text-green-800 ml-1">0%</span>
                </p>
                <p class="text-lg font-bold text-green-900 flex items-center">
                    <i data-lucide="trending-up" class="w-5 h-5 mr-2"></i> Est. Daily Earnings: 
                    <span id="dailyReturnAmount" class="ml-1 text-2xl">0.00 USDT</span>
                </p>
            </div>

            <button onclick="simulateGateway()" id="buyNowButton" disabled
                    class="w-full green-gradient-button py-4 rounded-xl text-white font-extrabold text-lg shadow-lg opacity-50 cursor-not-allowed">
                <i data-lucide="lock" class="w-5 h-5 mr-2 inline-block"></i> Buy Now (Min 10 USDT)
            </button>
        </section>
        
        <section id="buyTPHistoryView" data-view="buy-tp-history" class="hidden-view view bg-white p-6 rounded-3xl shadow-2xl">
            <h2 class="text-2xl font-bold text-gray-800 flex items-center mb-6 border-b pb-3">
                <i data-lucide="layers" class="w-6 h-6 mr-2 text-green-500"></i> TP Purchase History
            </h2>
            <div class="overflow-x-auto rounded-xl shadow-md border border-gray-200">
                <table class="min-w-full text-left border-collapse">
                    <thead class="bg-gray-100 sticky top-0">
                        <tr>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700">Date/Time </th>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700 text-right">Amount )</th>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700 text-right">Daily $\$$ Earning </th>
                        </tr>
                    </thead>
                    <tbody id="buyTPHistoryBody">
                        </tbody>
                </table>
            </div>
            <div id="buyTPHistoryPagination" class="flex justify-center items-center mt-6"></div>
        </section>
        
        <section id="referEarnView" data-view="refer-earn" class="hidden-view view bg-white p-6 rounded-3xl shadow-2xl">
            <h2 class="text-2xl font-bold text-gray-800 flex items-center mb-6 border-b pb-3">
                <i data-lucide="users" class="w-6 h-6 mr-2 text-pink-500"></i> Elite Referral Program 
            </h2>
            <div class="bg-pink-50 border-l-4 border-pink-500 p-4 rounded-xl mb-6 shadow-inner">
                <p class="text-sm font-semibold text-pink-700 mb-1">Total Referral Earnings :</p>
                <span class="text-4xl font-extrabold text-pink-600">$1,335.00</span>
                <p class="text-xs text-gray-500 mt-2">Earn up to 10 Levels deep. </p>
            </div>
            
            <div class="mb-8">
                <label for="referralLink" class="block text-sm font-semibold text-gray-700 mb-2">Your Invitation Link </label>
                <div class="flex">
                    <input type="text" id="referralLink" value="https://t.me/AproveDappBot?start=mock-user-12345" readonly
                           class="flex-1 p-3 border border-gray-300 rounded-l-xl text-gray-600 bg-gray-50 text-sm truncate">
                    <button onclick="copyReferralLink()" class="pink-gradient-button text-white px-4 rounded-r-xl font-bold text-sm flex items-center">
                        <i data-lucide="copy" class="w-4 h-4 mr-2"></i> Copy
                    </button>
                </div>
                <p class="text-xs text-gray-500 mt-1">Share this link to invite users via Telegram Bot.</p>
            </div>

            <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                 <i data-lucide="award" class="w-5 h-5 mr-2 text-yellow-500"></i> Level Structure
            </h3>
            <div class="overflow-x-auto rounded-xl shadow-md border border-gray-200">
                <table class="min-w-full text-left border-collapse">
                    <thead class="bg-gray-100 sticky top-0">
                        <tr>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700">Level</th>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700 text-center">Users </th>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700 text-right">Deposited</th>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700 text-right">Earned </th>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700 text-center">Details</th>
                        </tr>
                    </thead>
                    <tbody id="referralTableBody">
                        </tbody>
                </table>
            </div>
        </section>

        <section id="levelUsersView" data-view="level-users" class="hidden-view view bg-white p-6 rounded-3xl shadow-2xl">
            <h2 id="levelUsersTitle" class="text-2xl font-bold text-gray-800 flex items-center mb-6 border-b pb-3">
                <i data-lucide="users" class="w-6 h-6 mr-2 text-blue-500"></i> Users in Level X
            </h2>
            <p class="text-gray-600 mb-6 text-sm">Details of users and their initial investment (deposit) in this level. </p>
            
            <div id="levelUsersList" class="space-y-4">
                </div>
        </section>

        <section id="aiTradingStatusView" data-view="ai-trading-status" class="hidden-view view bg-white p-6 rounded-3xl shadow-2xl">
            <h2 class="text-2xl font-bold text-gray-800 flex items-center mb-6 border-b pb-3">
                <i data-lucide="activity" class="w-6 h-6 mr-2 text-blue-500"></i> AI Trading Status 
            </h2>
            <p class="text-gray-600 mb-4 text-sm font-semibold">Live trades executed by the AI on Forex pairs. (Last 10 Entries)</p>
            
            <div class="overflow-x-auto rounded-xl shadow-md border border-gray-200">
                <table class="min-w-full text-left border-collapse">
                    <thead class="bg-gray-800 sticky top-0">
                        <tr>
                            <th class="py-3 px-2 text-xs font-bold text-white uppercase trading-status-th">Pair/Side</th>
                            <th class="py-3 px-2 text-xs font-bold text-white uppercase trading-status-th">Leverage</th>
                            <th class="py-3 px-2 text-xs font-bold text-white uppercase trading-status-th text-right">Entry/Exit Price</th>
                            <th class="py-3 px-2 text-xs font-bold text-white uppercase trading-status-th text-right">% Profit</th>
                            <th class="py-3 px-2 text-xs font-bold text-white uppercase trading-status-th">Time (UTC)</th>
                        </tr>
                    </thead>
                    <tbody id="aiTradingHistoryBody">
                        </tbody>
                </table>
            </div>
        </section>

        <section id="myTradePowerView" data-view="my-trade-power" class="hidden-view view bg-white p-6 rounded-3xl shadow-2xl">
            <h2 class="text-2xl font-bold text-gray-800 flex items-center mb-6 border-b pb-3">
                <i data-lucide="layers-3d" class="w-6 h-6 mr-2 text-orange-500"></i> My Trade Power 
            </h2>
            <p class="text-gray-600 mb-6 text-sm">All your active TP packages with a 20-day validity status.</p>

            <div id="myTPPackagesList" class="space-y-6">
                </div>
        </section>
        
        <section id="introductionView" data-view="introduction" class="hidden-view view bg-white p-6 rounded-3xl shadow-2xl">
            <h2 class="text-2xl font-bold text-gray-800 flex items-center mb-6 border-b pb-3">
                <i data-lucide="info" class="w-6 h-6 mr-2 text-blue-500"></i> AiEarn: Company Profile
            </h2>
            
            <div class="space-y-6">
                <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-xl shadow-inner">
                    <h3 class="text-xl font-bold text-blue-800 mb-2 flex items-center">
                         <i data-lucide="brain" class="w-5 h-5 mr-2"></i> Our Vision
                    </h3>
                    <p class="text-gray-700">AiEarn is dedicated to pioneering AI-driven quantitative trading on major financial markets. We leverage advanced machine learning models (Quantum AI Engine) to identify high-probability trade setups, ensuring consistent and stable returns for our global investor community. Our mission is to democratize high-frequency trading through transparent and accessible technology.</p>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="p-4 bg-gray-50 rounded-xl shadow-md border border-gray-100">
                        <i data-lucide="shield-check" class="w-6 h-6 text-green-600 mb-2"></i>
                        <p class="font-bold text-gray-800 text-sm">Security & Compliance</p>
                        <p class="text-xs text-gray-600">Regulated operation with segregated funds protection.</p>
                    </div>
                    <div class="p-4 bg-gray-50 rounded-xl shadow-md border border-gray-100">
                        <i data-lucide="trending-up" class="w-6 h-6 text-purple-600 mb-2"></i>
                        <p class="font-bold text-gray-800 text-sm">High-Frequency Execution</p>
                        <p class="text-xs text-gray-600">Millions of trades executed daily with ultra-low latency.</p>
                    </div>
                </div>

                <h3 class="text-xl font-bold text-gray-800 pt-4 border-t mt-6 flex items-center">
                    <i data-lucide="file-text" class="w-5 h-5 mr-2 text-red-500"></i> Regulatory Documents
                </h3>
                <p class="text-gray-600 text-sm mb-4">View our official registration and compliance certificates.</p>

                <div class="space-y-3">
                    <a href="javascript:void(0)" onclick="showMessage('Document View', 'Viewing: Financial Regulator License (Mock Document)')" class="flex items-center p-4 bg-red-50 border border-red-200 rounded-xl shadow hover:shadow-lg transition">
                        <i data-lucide="file-badge" class="w-8 h-8 mr-4 text-red-600"></i>
                        <div>
                            <p class="font-bold text-red-800">Global Financial Regulator License</p>
                            <p class="text-sm text-gray-600">License ID: GF-2025-A12X | Valid till: 2030</p>
                        </div>
                        <i data-lucide="eye" class="w-5 h-5 ml-auto text-red-500"></i>
                    </a>
                    <a href="javascript:void(0)" onclick="showMessage('Document View', 'Viewing: Certificate of Incorporation (Mock Document)')" class="flex items-center p-4 bg-green-50 border border-green-200 rounded-xl shadow hover:shadow-lg transition">
                        <i data-lucide="file-check" class="w-8 h-8 mr-4 text-green-600"></i>
                        <div>
                            <p class="font-bold text-green-800">Certificate of Incorporation</p>
                            <p class="text-sm text-gray-600">Registration No: AI-INC-98765 | Date: 2022-05-15</p>
                        </div>
                        <i data-lucide="eye" class="w-5 h-5 ml-auto text-green-500"></i>
                    </a>
                </div>
            </div>
        </section>


        <section id="withdrawalView" data-view="withdrawal" class="hidden-view view bg-white p-6 rounded-3xl shadow-2xl">
            <h2 class="text-2xl font-bold text-gray-800 flex items-center mb-6 border-b pb-3">
                <i data-lucide="arrow-down-left" class="w-6 h-6 mr-2 text-orange-500"></i> Request Withdrawal 
            </h2>

            <div class="mb-6 bg-orange-50 border-l-4 border-orange-400 p-4 rounded-xl shadow-inner">
                <div class="flex justify-between items-center mb-2">
                    <p class="text-sm font-semibold text-orange-700" id="tgUserLabel">Your User ID:</p>
                    <span class="font-bold text-orange-900 bg-orange-100 px-3 py-1 rounded-full text-sm" id="tgUserDisplay">Loading ID...</span>
                </div>
                <div class="flex justify-between items-center">
                    <p class="text-lg font-semibold text-orange-700">Available Balance:</p>
                    <span class="text-3xl font-extrabold text-orange-600">450.75 USDT</span>
                </div>
            </div>

            <button onclick="reinvestAllBalance()" id="reinvestButton" class="w-full green-gradient-button py-3 rounded-xl text-white font-extrabold text-sm mb-6 flex items-center justify-center shadow-lg">
                <i data-lucide="layers-3d" class="w-4 h-4 mr-2"></i> Re-invest All Balance to TP 
            </button>
            
            <div class="mb-6">
                <label for="walletAddress" class="block text-sm font-semibold text-gray-700 mb-2">Your USDT Wallet Address (BEP20)</label>
                <div class="flex">
                    <input type="text" id="walletAddress" placeholder="Enter or paste your wallet address" value="0xMockAddress123..."
                           class="flex-1 p-3 border border-gray-300 rounded-l-xl text-gray-600 bg-gray-50 text-sm truncate focus:ring-blue-500 focus:border-blue-500">
                    <button onclick="showMessage('Wallet Save', 'Wallet address saved successfully!')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 rounded-r-xl font-bold text-sm flex items-center">
                        <i data-lucide="save" class="w-4 h-4 mr-2"></i> Save
                    </button>
                </div>
                <p class="text-xs text-red-500 mt-1">Ensure this is a correct BEP20 (Binance Smart Chain) USDT address.</p>
            </div>

            <div class="mb-8">
                <label for="withdrawalAmount" class="block text-sm font-semibold text-gray-700 mb-2">Withdrawal Amount (USDT)</label>
                <div class="relative rounded-xl shadow-inner border border-gray-200">
                    <input type="number" id="withdrawalAmount" placeholder="Min. 10 USDT" 
                           min="10" step="0.01" max="450.75"
                           class="input-usdt w-full p-4 pr-16 text-2xl font-bold text-gray-900 border-none bg-transparent focus:ring-orange-500 focus:border-orange-500 rounded-xl"
                           required>
                    <span class="absolute right-0 top-0 bottom-0 flex items-center pr-4 text-xl font-extrabold text-orange-600">USDT</span>
                </div>
                <p class="text-xs text-gray-500 mt-1">Fee: 1 USDT + 1% of the amount. (Minimum Withdrawal: 10 USDT)</p>
            </div>

            <button onclick="simulateWithdrawal()" id="withdrawalButton" 
                    class="w-full orange-gradient-button py-4 rounded-xl text-white font-extrabold text-lg shadow-lg">
                <i data-lucide="send" class="w-5 h-5 mr-2 inline-block"></i> Confirm Withdrawal
            </button>

            <h3 class="text-xl font-bold text-gray-800 flex items-center mb-4 mt-8 border-t pt-4">
                <i data-lucide="list-ordered" class="w-5 h-5 mr-2 text-gray-500"></i> Withdrawal History
            </h3>
            <div class="overflow-x-auto rounded-xl shadow-md border border-gray-200">
                <table class="min-w-full text-left border-collapse">
                    <thead class="bg-gray-100 sticky top-0">
                        <tr>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700">Amount </th>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700">Date </th>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700 text-center">Status/TXN</th>
                        </tr>
                    </thead>
                    <tbody id="withdrawalHistoryBody">
                        </tbody>
                </table>
            </div>
            <div id="withdrawalHistoryPagination" class="flex justify-center items-center mt-6"></div>

        </section>

        <section id="dailyEarningHistoryView" data-view="daily-earning-history" class="hidden-view view bg-white p-6 rounded-3xl shadow-2xl">
            <h2 class="text-2xl font-bold text-gray-800 flex items-center mb-6 border-b pb-3">
                <i data-lucide="history" class="w-6 h-6 mr-2 text-green-500"></i> Daily Earning History 
            </h2>
            <div class="overflow-x-auto rounded-xl shadow-md border border-gray-200">
                <table class="min-w-full text-left border-collapse">
                    <thead class="bg-gray-100 sticky top-0">
                        <tr>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700">Date </th>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700 text-right">Earning </th>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700 text-right">TP Rate </th>
                        </tr>
                    </thead>
                    <tbody id="dailyEarningHistoryBody">
                        </tbody>
                </table>
            </div>
            <div id="dailyEarningHistoryPagination" class="flex justify-center items-center mt-6"></div>
        </section>

    </div>

    <footer id="footer" class="bg-white border-t border-gray-200 fixed bottom-0 left-0 right-0 z-30 shadow-2xl">
        <div class="max-w-lg mx-auto flex justify-around items-center p-3">
            <button onclick="navigateTo('dashboardView')" class="flex flex-col items-center text-green-600 font-bold text-xs p-1">
                <i data-lucide="rocket" class="w-6 h-6 mb-1"></i>
                <span class="text-xs">AiEarn</span>
            </button>
            <button onclick="navigateTo('referEarnView')" class="flex flex-col items-center text-gray-500 hover:text-green-600 font-medium text-xs p-1">
                <i data-lucide="users" class="w-6 h-6 mb-1"></i>
                <span class="text-xs">Refer & Earn</span>
            </button>
            <button onclick="navigateTo('introductionView')" class="flex flex-col items-center text-gray-500 hover:text-green-600 font-medium text-xs p-1">
                <i data-lucide="info" class="w-6 h-6 mb-1"></i>
                <span class="text-xs">Introduction</span>
            </button>
            <button onclick="navigateTo('withdrawalView')" class="flex flex-col items-center text-gray-500 hover:text-green-600 font-medium text-xs p-1">
                <i data-lucide="arrow-down-left" class="w-6 h-6 mb-1"></i>
                <span class="text-xs">Withdrawal</span>
            </button>
        </div>
    </footer>

    <script>
        // --- Global State ---
        let currentPage = 'dashboardView'; // Default view
        const views = {};
        const viewTitles = {
            'dashboardView': 'AiEarn Dashboard',
            'buyTPView': 'TP Investment Portal',
            'buyTPHistoryView': 'TP Purchase History',
            'referEarnView': 'Refer & Earn Program',
            'levelUsersView': 'Referral Users Detail',
            'aiTradingStatusView': 'AI Trading Status',
            'myTradePowerView': 'My Trade Power',
            'withdrawalView': 'Request Withdrawal',
            'introductionView': 'Company Profile',
            'dailyEarningHistoryView': 'Daily Earning History',
            'weekendEarnView': 'WEEKEND EARN FAST',
            'weekendEarnHistoryView': 'Weekend Earn History'
        };
        const itemsPerPage = 10;
        let withdrawalHistoryCurrentPage = 1;
        let buyTPHistoryCurrentPage = 1;
        let dailyEarningHistoryCurrentPage = 1;
        let weekendEarnHistoryCurrentPage = 1; 

        // üü¢ 4. Telegram Global Variables
        let TG_USER_ID = '000000000'; // Fallback
        let TG_USERNAME = 'User';      // Fallback
        
        // ‚úÖ üéØ ‡§Ø‡§π‡§æ‡§Å ‡§Ü‡§™‡§ï‡•á ‡§¨‡•â‡§ü ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¨‡§¶‡§≤‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à!
        const TELEGRAM_BOT_USERNAME = 'AproveDappBot'; 
        
        let TG_INIT_DATA = null;
        

        // --- Mock Data / State Variables (Referral Data Updated) ---

        // Mock state to track weekly investment limit
        let hasInvestedThisWeek = false; 
        
        // Mock Available Balance
        let MOCK_AVAILABLE_BALANCE = 450.75;

        // Mock User TP Packages
        const mockUserTPPackages = [
            { id: 1, amount: 100, daysTotal: 20, activeDays: 15, dailyEarning: 0.060 },
            { id: 2, amount: 300, daysTotal: 20, activeDays: 20, dailyEarning: 0.065 }, // Expired
            { id: 3, amount: 1000, daysTotal: 20, activeDays: 5, dailyEarning: 0.070 }
        ];

        // Utility to generate mock data
        function generateMockData(count, factory) {
            const data = [];
            for (let i = 1; i <= count; i++) {
                data.push(factory(i));
            }
            return data;
        }

        // 25 Mock Withdrawal History Entries
        const mockWithdrawalHistory = generateMockData(25, (i) => ({
            id: i,
            amount: [25, 50, 100, 200][i % 4] + (Math.floor(Math.random() * 5) + 1),
            date: `2025-11-${String(30 - i).padStart(2, '0')}`,
            txnHash: i % 3 === 0 ? 'Processing...' : `0xABCDEF${String(1000 + i)}...`,
            status: i % 3 === 0 ? 'Processing' : 'Completed'
        })).sort((a, b) => b.id - a.id);

        // ROI Tiers definition (from highest to lowest threshold)
        const roiTiers = [
            { threshold: 3000, rate: 0.070, label: '7.0%' },
            { threshold: 300, rate: 0.065, label: '6.5%' },
            { threshold: 20, rate: 0.060, label: '6.0%' },
            { threshold: 0, rate: 0.055, label: '5.5%' }
        ];

        function getRoiDetails(amount) {
            const tier = roiTiers.find(t => amount >= t.threshold) || roiTiers[roiTiers.length - 1];
            return {
                rate: tier.rate,
                label: tier.label,
                dailyEarning: (amount * tier.rate).toFixed(4)
            };
        }

        // üü¢ 5. Mock Referral Data ‡§ï‡•ã ‡§∏‡§∞‡§≤ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ (usersDetail ‡§π‡§ü‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ)
        const mockReferralData = [
            { level: 1, users: 12, deposited: 5200, earnings: 52.00, commissionRate: '10%' },
            { level: 2, users: 45, deposited: 15500, earnings: 155.00, commissionRate: '5%' },
            { level: 3, users: 120, deposited: 32000, earnings: 320.00, commissionRate: '3%' },
            { level: 4, users: 200, deposited: 45000, earnings: 450.00, commissionRate: '2%' },
            { level: 5, users: 300, deposited: 50000, earnings: 350.00, commissionRate: '1%' },
            { level: 6, users: 400, deposited: 60000, earnings: 0.00, commissionRate: '0.5%' }
        ];

        // Mock AI Trading History (10 entries for cleaner view)
        const mockAITradingHistory = [
            { pair: 'EUR/USD', position: 'Long', leverage: '50X', entry: 1.0725, execute: 1.0730, profit: 0.45, time: '2025-11-12 10:05:30Z' },
            { pair: 'USD/JPY', position: 'Short', leverage: '100X', entry: 151.12, execute: 150.98, profit: 1.20, time: '2025-11-12 09:55:00Z' },
            { pair: 'GBP/USD', position: 'Long', leverage: '75X', entry: 1.2450, execute: 1.2458, profit: 0.65, time: '2025-11-12 09:40:00Z' },
            { pair: 'AUD/USD', position: 'Short', leverage: '20X', entry: 0.6522, execute: 0.6521, profit: 0.15, time: '2025-11-12 09:25:30Z' },
            { pair: 'EUR/GBP', position: 'Long', leverage: '50X', entry: 0.8550, execute: 0.8548, profit: -0.20, time: '2025-11-12 09:10:15Z' }, // Loss
            { pair: 'NZD/USD', position: 'Long', leverage: '100X', entry: 0.6055, execute: 0.6062, profit: 0.75, time: '2025-11-12 08:55:00Z' },
            { pair: 'XAU/USD', position: 'Short', leverage: '50X', entry: 1980.50, execute: 1978.90, profit: 1.50, time: '2025-11-12 08:40:40Z' },
            { pair: 'USD/CAD', position: 'Long', leverage: '75X', entry: 1.3650, execute: 1.3653, profit: 0.30, time: '2025-11-12 08:25:10Z' },
            { pair: 'EUR/JPY', position: 'Short', leverage: '50X', entry: 161.20, execute: 161.25, profit: -0.50, time: '2025-11-12 08:10:00Z' }, // Loss
            { pair: 'GBP/JPY', position: 'Long', leverage: '100X', entry: 188.45, execute: 188.60, profit: 0.95, time: '2025-11-12 07:55:30Z' }
        ].slice(0, 10); 

        // 25 Mock Buy TP History Entries
        const mockBuyTPHistory = generateMockData(25, (i) => {
            const amount = [50, 100, 300, 500, 1000, 3500, 50][i % 7] + (Math.floor(Math.random() * 10) + 1);
            const roi = getRoiDetails(amount);
            return {
                id: i,
                amount: amount,
                date: `2025-10-${String(30 - i).padStart(2, '0')} ${String(8 + i % 12).padStart(2, '0')}:30`,
                ...roi
            };
        }).sort((a, b) => b.id - a.id);

        // 25 Mock Daily Earning Entries
        const mockDailyEarningHistory = generateMockData(25, (i) => ({
            id: i,
            date: `2025-11-${String(30 - i).padStart(2, '0')}`,
            amount: (0.02 + Math.random() * 0.05).toFixed(4),
            rate: (5.5 + Math.random() * 0.5).toFixed(2) + '%'
        })).sort((a, b) => b.id - a.id);

        // Mock Weekend Earn History
        const mockWeekendEarnHistory = generateMockData(15, (i) => {
            const amount = [100, 150, 200, 500][i % 4] + (Math.floor(Math.random() * 5));
            const returnAmount = amount * 0.30;
            const status = i < 3 ? 'Completed' : 'Processing';
            return {
                id: i,
                amount: amount,
                date: `2025-11-${String(30 - i).padStart(2, '0')} ${String(8 + i % 12).padStart(2, '0')}:30`,
                returnAmount: returnAmount,
                status: status
            };
        }).sort((a, b) => b.id - a.id);


        // --- Pagination Logic (Reusable) ---
        function renderPaginationControls(totalItems, itemsPerPage, currentPage, targetViewId, paginationContainerId, setPageFn) {
            const container = document.getElementById(paginationContainerId);
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            container.innerHTML = '';

            if (totalPages <= 1) return;

            const maxButtons = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
            let endPage = Math.min(totalPages, startPage + maxButtons - 1);

            if (endPage - startPage + 1 < maxButtons) {
                startPage = Math.max(1, endPage - maxButtons + 1);
            }

            // Previous Button
            let prevButton = document.createElement('button');
            prevButton.className = 'pagination-button bg-gray-200 text-gray-700';
            prevButton.disabled = currentPage === 1;
            prevButton.innerHTML = '<i data-lucide="chevron-left" class="w-4 h-4"></i>';
            prevButton.onclick = () => {
                setPageFn(currentPage - 1);
                navigateTo(targetViewId);
            };
            container.appendChild(prevButton);

            // Page Number Buttons
            for (let i = startPage; i <= endPage; i++) {
                let button = document.createElement('button');
                button.className = `pagination-button ${i === currentPage ? 'active' : 'bg-gray-200 text-gray-700'}`;
                button.textContent = i;
                button.onclick = () => {
                    setPageFn(i);
                    navigateTo(targetViewId);
                };
                container.appendChild(button);
            }

            // Next Button
            let nextButton = document.createElement('button');
            nextButton.className = 'pagination-button bg-gray-200 text-gray-700';
            nextButton.disabled = currentPage === totalPages;
            nextButton.innerHTML = '<i data-lucide="chevron-right" class="w-4 h-4"></i>';
            nextButton.onclick = () => {
                setPageFn(currentPage + 1);
                navigateTo(targetViewId);
            };
            container.appendChild(nextButton);

            lucide.createIcons();
        }

        function renderWithdrawalRow(item) {
            const statusColor = item.status === 'Completed' ? 'text-green-600' : 'text-orange-500';
            const statusIcon = item.status === 'Completed' ? 'check-circle' : 'loader';
            return `
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-3 px-4 text-sm font-bold text-gray-800">$${item.amount.toFixed(2)}</td>
                    <td class="py-3 px-4 text-xs font-medium text-gray-600">${item.date.split(' ')[0]}</td>
                    <td class="py-3 px-4 text-xs text-right">
                        <span class="font-semibold ${statusColor} flex items-center justify-end">
                            <i data-lucide="${statusIcon}" class="w-3 h-3 mr-1"></i> ${item.status}
                        </span>
                        <span class="block text-gray-400 text-[10px] truncate w-24 ml-auto">${item.txnHash}</span>
                    </td>
                </tr>
            `;
        }

        function renderBuyTPRow(item) {
            return `
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-3 px-4 text-xs font-medium text-gray-600">${item.date}</td>
                    <td class="py-3 px-4 text-sm font-bold text-gray-800 text-right">$${item.amount.toFixed(2)}</td>
                    <td class="py-3 px-4 text-xs text-right">
                        <span class="font-bold text-green-600">$${item.dailyEarning}</span>
                        <span class="block text-gray-400 text-[10px]">(${item.label})</span>
                    </td>
                </tr>
            `;
        }
        
        function renderDailyEarningRow(item) {
            return `
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-3 px-4 text-xs font-medium text-gray-600">${item.date}</td>
                    <td class="py-3 px-4 text-sm font-bold text-green-600 text-right">$${item.amount}</td>
                    <td class="py-3 px-4 text-xs text-right text-gray-700">${item.rate}</td>
                </tr>
            `;
        }

        function renderWeekendEarnRow(item) {
            const statusColor = item.status === 'Completed' ? 'text-green-600' : 'text-orange-500';
            const statusIcon = item.status === 'Completed' ? 'check-circle' : 'loader';
            const totalReturn = item.amount + item.returnAmount;
            return `
                <tr class="border-b border-gray-100 hover:bg-yellow-50">
                    <td class="py-3 px-4 text-xs font-medium text-gray-600">${item.date.split(' ')[0]}<span class="block text-gray-400 text-[10px]">${item.date.split(' ')[1]}</span></td>
                    <td class="py-3 px-4 text-sm font-bold text-yellow-800 text-right">$${item.amount.toFixed(2)}</td>
                    <td class="py-3 px-4 text-sm font-bold text-green-600 text-right">
                        + $${item.returnAmount.toFixed(2)}
                        <span class="block text-gray-400 text-[10px]">Total: $${totalReturn.toFixed(2)}</span>
                    </td>
                    <td class="py-3 px-4 text-xs text-center">
                        <span class="font-semibold ${statusColor} flex items-center justify-center">
                            <i data-lucide="${statusIcon}" class="w-3 h-3 mr-1"></i> ${item.status}
                        </span>
                    </td>
                </tr>
            `;
        }


        function renderWithdrawalHistory(page) {
            const body = document.getElementById('withdrawalHistoryBody');
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedItems = mockWithdrawalHistory.slice(startIndex, endIndex);

            body.innerHTML = paginatedItems.map(renderWithdrawalRow).join('');

            renderPaginationControls(
                mockWithdrawalHistory.length,
                itemsPerPage,
                page,
                'withdrawalView',
                'withdrawalHistoryPagination',
                (p) => withdrawalHistoryCurrentPage = p
            );
            lucide.createIcons();
        }

        function renderBuyTPHistory(page) {
            const body = document.getElementById('buyTPHistoryBody');
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedItems = mockBuyTPHistory.slice(startIndex, endIndex);

            body.innerHTML = paginatedItems.map(renderBuyTPRow).join('');

            renderPaginationControls(
                mockBuyTPHistory.length,
                itemsPerPage,
                page,
                'buyTPHistoryView',
                'buyTPHistoryPagination',
                (p) => buyTPHistoryCurrentPage = p
            );
            lucide.createIcons();
        }
        
        function renderDailyEarningHistory(page) {
            const body = document.getElementById('dailyEarningHistoryBody');
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedItems = mockDailyEarningHistory.slice(startIndex, endIndex);

            body.innerHTML = paginatedItems.map(renderDailyEarningRow).join('');

            renderPaginationControls(
                mockDailyEarningHistory.length,
                itemsPerPage,
                page,
                'dailyEarningHistoryView',
                'dailyEarningHistoryPagination',
                (p) => dailyEarningHistoryCurrentPage = p
            );
            lucide.createIcons();
        }

        function renderWeekendEarnHistory(page) {
            const body = document.getElementById('weekendEarnHistoryBody');
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedItems = mockWeekendEarnHistory.slice(startIndex, endIndex);

            body.innerHTML = paginatedItems.map(renderWeekendEarnRow).join('');

            renderPaginationControls(
                mockWeekendEarnHistory.length,
                itemsPerPage,
                page,
                'weekendEarnHistoryView',
                'weekendEarnHistoryPagination',
                (p) => weekendEarnHistoryCurrentPage = p
            );
            lucide.createIcons();
        }

        function renderAITradingStatus() {
            const body = document.getElementById('aiTradingHistoryBody');
            let html = mockAITradingHistory.map(item => {
                const isProfit = item.profit >= 0;
                const profitColor = isProfit ? 'text-green-500 bg-green-50' : 'text-red-500 bg-red-50';
                const sideColor = item.position === 'Long' ? 'text-green-600' : 'text-red-600';

                return `
                    <tr class="border-b border-gray-700 hover:bg-gray-800 transition">
                        <td class="py-3 px-2 text-xs font-bold text-white">
                            ${item.pair}
                            <span class="block text-[10px] font-semibold ${sideColor}">${item.position}</span>
                        </td>
                        <td class="py-3 px-2 text-xs font-semibold text-gray-600">${item.leverage}</td>
                        <td class="py-3 px-2 text-xs text-right">
                            <span class="block font-bold text-gray-800">${item.entry.toFixed(4)}</span>
                            <span class="block text-gray-400 text-[10px]">${item.execute.toFixed(4)}</span>
                        </td>
                        <td class="py-3 px-2 text-xs text-right">
                            <span class="font-extrabold ${profitColor} p-1 rounded-md inline-block">
                                ${isProfit ? '+' : ''}${item.profit.toFixed(2)}%
                            </span>
                        </td>
                        <td class="py-3 px-2 text-xs text-gray-500 w-16">${item.time.split(' ')[1].slice(0, 5)}</td>
                    </tr>
                `;
            }).join('');
            body.innerHTML = html;
        }

        function renderMyTradePower() {
            const list = document.getElementById('myTPPackagesList');
            let html = mockUserTPPackages.map(item => {
                const daysRemaining = item.daysTotal - item.activeDays;
                const percentage = Math.min(100, (item.activeDays / item.daysTotal) * 100);
                const progressColor = percentage < 75 ? 'bg-green-500' : 'bg-red-500';
                const statusLabel = daysRemaining > 0 ? `${daysRemaining} Days Left` : 'Expired!';
                const statusColor = daysRemaining > 0 ? 'text-green-600' : 'text-red-600';
                const cardBorder = daysRemaining > 0 ? 'border-green-300' : 'border-red-300';

                // Calculate estimated daily return
                const dailyReturn = (item.amount * item.dailyEarning).toFixed(4);

                return `
                    <div class="bg-white p-5 rounded-2xl shadow-xl border-t-8 ${cardBorder} space-y-3">
                        <div class="flex justify-between items-center border-b pb-3">
                            <h3 class="text-2xl font-extrabold text-gray-800">
                                $${item.amount.toLocaleString()} <span class="text-sm font-medium text-gray-500">TP Package</span>
                            </h3>
                            <span class="font-bold text-lg ${statusColor} bg-gray-100 px-3 py-1 rounded-full">${statusLabel}</span>
                        </div>
                        <div class="flex justify-between items-center text-sm font-medium">
                            <div class="flex items-center text-gray-700">
                                <i data-lucide="zap" class="w-4 h-4 mr-1 text-green-500"></i> Daily ROI: 
                                <span class="font-bold text-green-600 ml-1">${(item.dailyEarning * 100).toFixed(1)}%</span>
                            </div>
                            <div class="flex items-center text-gray-700">
                                <i data-lucide="dollar-sign" class="w-4 h-4 mr-1 text-purple-500"></i> Daily \$ Return: 
                                <span class="font-bold text-purple-600 ml-1">$${dailyReturn}</span>
                            </div>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                            <div class="${progressColor} h-2.5 rounded-full" style="width: ${percentage}%"></div>
                        </div>
                        <div class="flex justify-between text-xs text-gray-500">
                            <span>Started: ${item.activeDays} days ago</span>
                            <span>Total Duration: ${item.daysTotal} days</span>
                        </div>
                    </div>
                `;
            }).join('');
            
            if (mockUserTPPackages.length === 0) {
                 html = `<p class="text-center py-10 text-gray-500 font-semibold">You do not have any active Trade Power packages. Invest now!</p>`;
            }
            
            list.innerHTML = html;
            lucide.createIcons();
        }

        // --- Buy TP Logic ---
        const usdtInput = document.getElementById('usdtAmount');
        const buyButton = document.getElementById('buyNowButton');
        const rateDisplay = document.getElementById('dailyRateDisplay');
        const amountDisplay = document.getElementById('dailyReturnAmount');

        function calculateReturn(usdtValue) {
            const amount = parseFloat(usdtValue);
            const minInvest = 10;
            
            if (isNaN(amount) || amount < minInvest) {
                rateDisplay.textContent = '0%';
                amountDisplay.textContent = '0.00 USDT';
                buyButton.disabled = true;
                buyButton.classList.add('opacity-50', 'cursor-not-allowed');
                buyButton.classList.remove('hover:opacity-95');
                buyButton.innerHTML = `<i data-lucide="lock" class="w-5 h-5 mr-2 inline-block"></i> Buy Now (Min ${minInvest} USDT)`;
                lucide.createIcons();
                return;
            }

            const tier = roiTiers.find(t => amount >= t.threshold);
            const rate = tier ? tier.rate : roiTiers[roiTiers.length - 1].rate;
            const rateLabel = tier ? tier.label : '5.5%';
            const dailyReturn = amount * rate;
            
            rateDisplay.textContent = rateLabel;
            amountDisplay.textContent = `${dailyReturn.toFixed(4)} USDT`;
            buyButton.disabled = false;
            buyButton.classList.remove('opacity-50', 'cursor-not-allowed');
            buyButton.classList.add('hover:opacity-95');
            buyButton.innerHTML = '<i data-lucide="check-circle" class="w-5 h-5 mr-2 inline-block"></i> Buy Now (Open Gateway)';
            lucide.createIcons();
        }

        function simulateGateway() {
            const amount = usdtInput.value;
            if (parseFloat(amount) < 10) {
                showMessage('Investment Error', 'Minimum investment is 10 USDT.');
                return;
            }

            // Simulate history update
            const roi = getRoiDetails(parseFloat(amount));
            const newEntry = {
                id: mockBuyTPHistory.length + 1,
                amount: parseFloat(amount),
                date: new Date().toISOString().slice(0, 16).replace('T', ' '),
                ...roi
            };
            mockBuyTPHistory.unshift(newEntry);
            
            // Clear form and navigate back to dashboard
            usdtInput.value = '';
            calculateReturn(0);

            // Update user's TP
            const newTP = parseFloat(amount) / 200; // Mock calculation
            showMessage('TP Purchased!', `Successfully bought ${newTP.toFixed(2)} TP with ${parseFloat(amount).toFixed(2)} USDT! Your new daily ROI is ${roi.label}.`);
            navigateTo('dashboardView');
        }

        // --- Weekend Earn Logic (UPDATED) ---
        const weekendAmountInput = document.getElementById('weekendAmount');
        const weekendBuyButton = document.getElementById('weekendBuyButton');
        const weekendRateDisplay = document.getElementById('weekendRateDisplay');
        const weekendReturnAmount = document.getElementById('weekendReturnAmount');
        const WEEKEND_RATE = 0.30; // 30% return
        const WEEKEND_MIN_INVEST = 100; 
        const weekendDashboardButton = document.getElementById('weekendDashboardButton');
        const restrictionText = document.getElementById('weekendRestrictionText');

        function calculateWeekendReturn(usdtValue) {
            const amount = parseFloat(usdtValue);
            const minInvest = WEEKEND_MIN_INVEST;
            
            if (hasInvestedThisWeek) {
                // If already invested, prevent calculation/button activation
                weekendRateDisplay.textContent = '30%';
                weekendReturnAmount.textContent = '0.00 USDT';
                weekendBuyButton.disabled = true;
                return;
            }

            if (isNaN(amount) || amount < minInvest) {
                weekendRateDisplay.textContent = '30%';
                weekendReturnAmount.textContent = '0.00 USDT';
                weekendBuyButton.disabled = true;
                weekendBuyButton.classList.add('opacity-50', 'cursor-not-allowed');
                weekendBuyButton.classList.remove('hover:opacity-95');
                // Updated button text
                weekendBuyButton.innerHTML = `<i data-lucide="lock" class="w-5 h-5 mr-2 inline-block"></i> Invest Now (Min ${minInvest} USDT)`;
                lucide.createIcons();
                return;
            }

            const totalReturn = amount * WEEKEND_RATE;
            weekendReturnAmount.textContent = `${totalReturn.toFixed(4)} USDT`;
            weekendBuyButton.disabled = false;
            weekendBuyButton.classList.remove('opacity-50', 'cursor-not-allowed');
            weekendBuyButton.classList.add('hover:opacity-95');
            weekendBuyButton.innerHTML = `<i data-lucide="zap" class="w-5 h-5 mr-2 inline-block"></i> Confirm Investment (${amount.toFixed(2)} USDT)`;
            lucide.createIcons();
        }

        function simulateWeekendGateway() {
            const amount = parseFloat(weekendAmountInput.value);
            if (isNaN(amount) || amount < WEEKEND_MIN_INVEST || hasInvestedThisWeek) {
                showMessage('Investment Error', `Minimum investment is ${WEEKEND_MIN_INVEST} USDT and can only be done once per week.`);
                return;
            }

            const returnAmount = amount * WEEKEND_RATE;
            const totalReturn = amount + returnAmount;

            // 1. Update state
            hasInvestedThisWeek = true;
            
            // 2. Add to history
            const newEntry = {
                id: mockWeekendEarnHistory.length + 1,
                amount: amount,
                date: new Date().toISOString().slice(0, 16).replace('T', ' '),
                returnAmount: returnAmount,
                status: 'Processing'
            };
            mockWeekendEarnHistory.unshift(newEntry);

            // 3. Clear form and navigate back to dashboard/update view
            weekendAmountInput.value = '';
            checkWeekendEligibility(); // Apply restrictions
            navigateTo('dashboardView');

            showMessage(
                'Weekend Investment Initiated',
                `Successfully invested ${parseFloat(amount).toFixed(2)} USDT into WEEKEND EARN FAST! You are expected to receive ${totalReturn.toFixed(2)} USDT profit in 48 hours. (Weekly Limit Used)`
            );
        }
        
        function checkWeekendEligibility() {
            // Dashboard Button Update
            if (weekendDashboardButton) {
                if (hasInvestedThisWeek) {
                    weekendDashboardButton.classList.add('opacity-50', 'cursor-not-allowed');
                    weekendDashboardButton.classList.remove('hover:bg-yellow-500');
                    weekendDashboardButton.textContent = 'LIMIT USED';
                    weekendDashboardButton.setAttribute('disabled', 'true');
                } else {
                    weekendDashboardButton.classList.remove('opacity-50', 'cursor-not-allowed');
                    weekendDashboardButton.classList.add('hover:bg-yellow-500');
                    weekendDashboardButton.textContent = "LET'S GO";
                    weekendDashboardButton.removeAttribute('disabled');
                }
            }

            // Weekend View Update
            if (weekendAmountInput && restrictionText) {
                const minInvest = WEEKEND_MIN_INVEST;
                if (hasInvestedThisWeek) {
                    weekendAmountInput.setAttribute('disabled', 'true');
                    weekendAmountInput.value = '';
                    weekendAmountInput.placeholder = 'Already invested this week';
                    weekendBuyButton.setAttribute('disabled', 'true');
                    weekendBuyButton.classList.add('opacity-50', 'cursor-not-allowed');
                    weekendBuyButton.classList.remove('hover:opacity-95');
                    weekendBuyButton.innerHTML = '<i data-lucide="x-circle" class="w-5 h-5 mr-2 inline-block"></i> Weekly Limit Reached';
                    restrictionText.innerHTML = `<span class="font-bold text-red-500">üö´ Weekly Limit Reached:</span> You must wait until next week to invest again. (Minimum ${minInvest} USDT)`;
                } else {
                    weekendAmountInput.removeAttribute('disabled');
                    weekendAmountInput.placeholder = `Min. ${minInvest} USDT`;
                    restrictionText.innerHTML = `Invest for a short-term, high-return opportunity. (Minimum ${minInvest} USDT, **Once per week**)`;
                    // Reset button/calculation state
                    calculateWeekendReturn(weekendAmountInput.value);
                }
                lucide.createIcons();
            }
        }

        // --- Referral Logic ---
        const referralTableBody = document.getElementById('referralTableBody');
        const levelUsersTitle = document.getElementById('levelUsersTitle');
        const levelUsersList = document.getElementById('levelUsersList');
        const referralLinkInput = document.getElementById('referralLink');

        function populateReferralTable() {
            let html = '';
            mockReferralData.forEach(data => {
                const isHighlighted = data.level === 1; // Highlight Level 1 only
                html += `
                    <tr class="border-b border-gray-100 ${isHighlighted ? 'bg-yellow-50 hover:bg-yellow-100' : 'hover:bg-gray-50'}">
                        <td class="py-3 px-4 text-xs font-bold text-gray-800">${data.level} <span class="block text-gray-500 text-[10px]">${data.commissionRate} Comm.</span></td>
                        <td class="py-3 px-4 text-xs text-center font-medium text-gray-600">${data.users + (parseInt(TG_USER_ID.slice(-1)) || 0)}</td>
                        <td class="py-3 px-4 text-xs text-right font-medium text-gray-600">$${data.deposited.toLocaleString()}</td>
                        <td class="py-3 px-4 text-xs text-right font-bold text-green-600">$${data.earnings.toFixed(2)}</td>
                        <td class="py-3 px-4 text-xs text-center">
                            <button onclick="showLevelUsers(${data.level})" class="text-blue-500 hover:text-blue-700 text-xs font-semibold px-2 py-1 rounded-full border border-blue-200 hover:bg-blue-50 transition">
                                Preview (${data.users + (parseInt(TG_USER_ID.slice(-1)) || 0)})
                            </button>
                        </td>
                    </tr>
                `;
            });
            referralTableBody.innerHTML = html;

            // ‚úÖ 7. Referral Link ‡§ï‡•ã Bot Link ‡§∏‡•á ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
            if (referralLinkInput) {
                referralLinkInput.value = `https://t.me/${TELEGRAM_BOT_USERNAME}?start=${TG_USER_ID}`;
            }
        }

        function copyReferralLink() {
            const linkInput = document.getElementById('referralLink');
            linkInput.select();
            document.execCommand('copy');
            showMessage('Success!', 'Your Referral link has been copied to the clipboard.');
            
            // üü¢ 8. Telegram Web App ‡§ï‡•ã ‡§ï‡•â‡§™‡•Ä ‡§´‡§º‡•Ä‡§°‡§¨‡•à‡§ï ‡§¶‡•á‡§Ç
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.HapticFeedback.notificationOccurred('success');
            }
        }

        // ‚úÖ 9. showLevelUsers ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§ï‡•ã ‡§™‡•Ç‡§∞‡•Ä ‡§§‡§∞‡§π ‡§∏‡•á ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à
        function showLevelUsers(level) {
            const levelData = mockReferralData.find(d => d.level === level);
            if (!levelData) return;

            levelUsersTitle.innerHTML = `<i data-lucide="users" class="w-6 h-6 mr-2 text-blue-500"></i> Users in Level ${level} (‡§≤‡•á‡§µ‡§≤ ${level} ‡§ï‡•á ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ)`;
            
            // Total users in this level (mocked based on initial count + random from ID)
            const totalUsers = levelData.users + (parseInt(TG_USER_ID.slice(-1)) || 0);

            let usersHtml = '';
            
            if (totalUsers === 0) {
                usersHtml = `<p class="text-center py-10 text-gray-500 font-semibold">No active user details to display for this level yet.</p>`;
            } else {
                // Dynamic generation of mock user details to simulate hierarchy
                const mockNames = ['Aman S.', 'Priya K.', 'Vikram R.', 'Neha J.', 'Karan M.', 'Sonal B.', 'Rajesh P.', 'Anil D.', 'Kiran B.', 'Zoya F.'];
                
                // Show max 15 users for performance
                for (let i = 1; i <= Math.min(totalUsers, 15); i++) { 
                    const userName = mockNames[(i + level * 2) % mockNames.length];
                    const deposit = (100 + (i * 50) * Math.random()).toFixed(2);
                    
                    let referrerDisplay;
                    if (level === 1) {
                        // If Level 1, the referrer is the current user (You).
                        referrerDisplay = `<p class="text-xs text-blue-500 font-bold">Referred by: You (${TG_USERNAME})</p>`;
                    } else {
                        // If Level 2+, the referrer is a mock user from the previous level.
                        const referrerName = mockNames[(i + level * 3) % mockNames.length] + ' (L' + (level - 1) + ')';
                        referrerDisplay = `<p class="text-xs text-blue-500 font-bold">Referred by: ${referrerName}</p>`;
                    }

                    usersHtml += `
                        <div class="p-4 bg-gray-50 rounded-xl shadow-inner flex justify-between items-center border border-gray-200">
                            <div>
                                <p class="font-semibold text-gray-800">${userName} (ID: ${1000 + i + level * 100})</p>
                                ${referrerDisplay}
                                <p class="text-xs text-gray-500">Joined: 2025-10-${String(i).padStart(2, '0')}</p>
                            </div>
                            <span class="font-bold text-lg text-green-600">$${deposit}</span>
                        </div>
                    `;
                }
            }

            levelUsersList.innerHTML = usersHtml;
            lucide.createIcons();
            navigateTo('levelUsersView');
        }

        // --- Withdrawal Logic ---
        const withdrawalAmountInput = document.getElementById('withdrawalAmount');

        function simulateWithdrawal() {
            const amount = parseFloat(withdrawalAmountInput.value);
            const minWithdraw = 10;
            const availableBalance = MOCK_AVAILABLE_BALANCE;

            if (isNaN(amount) || amount < minWithdraw) {
                showMessage('Withdrawal Error', `Minimum withdrawal amount is ${minWithdraw} USDT.`);
                return;
            }

            if (amount > availableBalance) {
                showMessage('Withdrawal Error', `Insufficient balance. Available: ${availableBalance.toFixed(2)} USDT.`);
                return;
            }

            // Simulate fee calculation (1 USDT + 1%)
            const fee = 1 + (amount * 0.01);
            const netAmount = amount - fee;
            
            // Update mock balance
            MOCK_AVAILABLE_BALANCE -= amount;
            document.querySelector('#withdrawalView .text-3xl.font-extrabold.text-orange-600').textContent = `${MOCK_AVAILABLE_BALANCE.toFixed(2)} USDT`;

            // Add to mock history
            const newWithdrawal = { id: mockWithdrawalHistory.length + 1, amount: amount, date: new Date().toISOString().split('T')[0], txnHash: 'Processing...', status: 'Processing' };
            mockWithdrawalHistory.unshift(newWithdrawal);
            
            renderWithdrawalHistory(1); // Re-render first page
            withdrawalAmountInput.value = ''; // Clear input
            
            showMessage('Withdrawal Initiated', `Your request for ${amount.toFixed(2)} USDT (Net: ${netAmount.toFixed(2)} USDT) has been submitted. It is now processing.`);
            
            // üü¢ 10. Telegram Web App ‡§ï‡•ã ‡§∏‡§ï‡•ç‡§∏‡•á‡§∏ ‡§´‡§º‡•Ä‡§°‡§¨‡•à‡§ï ‡§¶‡•á‡§Ç
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.HapticFeedback.notificationOccurred('success');
            }
        }

        // NEW FUNCTION: Auto-invest all available balance to TP
        function reinvestAllBalance() {
            // NOTE: This is a simulation.
            const amount = MOCK_AVAILABLE_BALANCE;
            const minReinvest = 10;
            const newBalance = 0;

            if (amount < minReinvest) {
                showMessage('Re-invest Error', `Minimum re-investment amount is ${minReinvest} USDT. Available: ${amount.toFixed(2)} USDT.`);
                return;
            }
            
            // 1. Simulate TP purchase logic (get ROI details)
            const roi = getRoiDetails(amount);
            
            // 2. Add a new TP package (mocking)
            const newTPPackage = {
                id: mockUserTPPackages.length + 1,
                amount: amount,
                daysTotal: 20,
                activeDays: 0,
                dailyEarning: roi.rate
            };
            mockUserTPPackages.push(newTPPackage);
            
            // 3. Update mock balance
            MOCK_AVAILABLE_BALANCE = newBalance;
            // Update the display immediately
            document.querySelector('#withdrawalView .text-3xl.font-extrabold.text-orange-600').textContent = `${MOCK_AVAILABLE_BALANCE.toFixed(2)} USDT`;

            // 4. Disable the button after reinvestment
            const reinvestBtn = document.getElementById('reinvestButton');
            if (reinvestBtn) {
                reinvestBtn.disabled = true;
                reinvestBtn.classList.add('opacity-50');
            }

            showMessage(
                'TP Re-investment Successful',
                `Successfully re-invested ${amount.toFixed(2)} USDT into Trade Power (TP). Your daily earnings will increase!`
            );
             // üü¢ 11. Telegram Web App ‡§ï‡•ã ‡§∏‡§ï‡•ç‡§∏‡•á‡§∏ ‡§´‡§º‡•Ä‡§°‡§¨‡•à‡§ï ‡§¶‡•á‡§Ç
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.HapticFeedback.notificationOccurred('success');
            }
        }


        // --- General View Navigation and UI Management ---
        function renderHeader(viewId) {
            const header = document.getElementById('header');
            let title = viewTitles[viewId] || 'AiEarn';
            let backButtonHtml = '';
            
            if (viewId !== 'dashboardView') {
                // Determine the correct view to go back to
                let backToView = 'dashboardView';
                if (viewId === 'levelUsersView') {
                    backToView = 'referEarnView'; // Go back to Refer & Earn from User List
                } else if (viewId === 'buyTPHistoryView') {
                    backToView = 'buyTPView'; // Go back to Buy TP form from History
                } else if (viewId === 'weekendEarnHistoryView') {
                    backToView = 'weekendEarnView'; // Go back to Weekend Earn form from History
                } else if (viewId === 'buyTPView') {
                    backToView = 'dashboardView';
                } else if (viewId === 'referEarnView') {
                    backToView = 'dashboardView';
                }
                
                backButtonHtml = `
                    <button onclick="navigateTo('${backToView}')" class="text-gray-500 hover:text-gray-700 p-1 rounded-full hover:bg-gray-100">
                        <i data-lucide="arrow-left" class="w-6 h-6"></i>
                    </button>
                `;
            }

            header.innerHTML = `
                <div class="max-w-lg mx-auto flex justify-between items-center">
                    <div class="flex items-center space-x-2">
                        ${backButtonHtml}
                        <h1 class="text-xl font-extrabold text-gray-800">${title}</h1>
                    </div>
                    <button onclick="console.log('Settings')" class="text-gray-500 hover:text-gray-700 p-1 rounded-full hover:bg-gray-100">
                        <i data-lucide="bell" class="w-6 h-6"></i>
                    </button>
                </div>
            `;
            lucide.createIcons();
        }

        function navigateTo(viewId) {
            // Hide all views
            document.querySelectorAll('#appContainer > section').forEach(view => {
                view.classList.remove('view');
                view.classList.add('hidden-view');
            });

            // Show the target view
            const newView = document.getElementById(viewId);
            if (newView) {
                newView.classList.remove('hidden-view');
                newView.classList.add('view');
            } else {
                console.error(`View ID not found: ${viewId}`);
                return;
            }

            currentPage = viewId;
            renderHeader(viewId);

            // --- Special initialization for specific views ---
            if (viewId === 'dashboardView' || viewId === 'weekendEarnView') {
                checkWeekendEligibility();
            }

            if (viewId === 'referEarnView') {
                populateReferralTable();
            } else if (viewId === 'weekendEarnHistoryView') {
                renderWeekendEarnHistory(weekendEarnHistoryCurrentPage);
            } else if (viewId === 'withdrawalView') {
                const balanceSpan = document.querySelector('#withdrawalView .text-3xl.font-extrabold.text-orange-600');
                if (balanceSpan) {
                    balanceSpan.textContent = `${MOCK_AVAILABLE_BALANCE.toFixed(2)} USDT`;
                }
                const reinvestBtn = document.getElementById('reinvestButton');
                if (reinvestBtn) {
                    reinvestBtn.disabled = false;
                    reinvestBtn.classList.remove('opacity-50');
                }
                renderWithdrawalHistory(withdrawalHistoryCurrentPage);
            } else if (viewId === 'buyTPHistoryView') {
                renderBuyTPHistory(buyTPHistoryCurrentPage);
            } else if (viewId === 'dailyEarningHistoryView') {
                renderDailyEarningHistory(dailyEarningHistoryCurrentPage);
            } else if (viewId === 'aiTradingStatusView') {
                renderAITradingStatus();
            } else if (viewId === 'myTradePowerView') {
                renderMyTradePower();
            }
        }


        // --- Other Feature Logic ---
        
        const timerElement = document.getElementById('settlement-timer');
        let totalSeconds = (19 * 3600) + (44 * 60) + 22;

        function formatTime(seconds) {
            const h = String(Math.floor(seconds / 3600)).padStart(2, '0');
            const m = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
            const s = String(seconds % 60).padStart(2, '0');
            return `${h}h ${m}m ${s}s`;
        }

        function updateTimer() {
            if (timerElement) {
                timerElement.textContent = `Settlement time: ${formatTime(totalSeconds)}`;
            }

            if (totalSeconds > 0) {
                totalSeconds--;
            } else {
                totalSeconds = (24 * 3600) - 1; // Reset to almost 24 hours
                showMessage('Settlement Complete', 'Daily earning settlement has been processed! Your balance has been updated.');
            }
        }
        
        function showMessage(title, message) {
            const messageBox = document.createElement('div');
            messageBox.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            messageBox.innerHTML = `
                <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full text-center transform scale-95 transition-all duration-300 ease-out animate-in fade-in zoom-in">
                    <h3 class="text-xl font-bold mb-3 text-gray-800">${title}</h3>
                    <p class="text-gray-600 mb-5">${message}</p>
                    <button onclick="this.parentNode.parentNode.remove()" class="bg-blue-600 text-white px-5 py-2 rounded-lg font-semibold hover:bg-blue-700 transition">OK</button>
                </div>
            `;
            document.body.appendChild(messageBox);
        }

        // üü¢ 12. Telegram Web App Initialization Logic
        function initializeTelegramWebApp() {
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
                
                // Hide main button if it's not needed (standard for mini apps)
                window.Telegram.WebApp.MainButton.hide();

                // üü¢ Telegram Theme Colors ‡§≤‡§æ‡§ó‡•Ç ‡§ï‡§∞‡•á‡§Ç
                const themeParams = window.Telegram.WebApp.themeParams;
                if (themeParams) {
                    document.documentElement.style.setProperty('--tg-bg-color', themeParams.bg_color || '#f0f2f5');
                    document.documentElement.style.setProperty('--tg-text-color', themeParams.text_color || '#1f2937');
                    document.documentElement.style.setProperty('--tg-hint-color', themeParams.hint_color || '#9ca3af');
                }
                
                // üü¢ User Data ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç
                const userData = window.Telegram.WebApp.initDataUnsafe.user;
                if (userData) {
                    TG_INIT_DATA = window.Telegram.WebApp.initDataUnsafe;
                    TG_USER_ID = userData.id.toString();
                    
                    // User ‡§ï‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ ‡§Ø‡§æ Username ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç
                    let userName = userData.first_name || '';
                    if (userData.last_name) {
                        userName += ' ' + userData.last_name;
                    }
                    if (userData.username) {
                        userName += ` (@${userData.username})`;
                    }
                    TG_USERNAME = userName.trim() || `User_${TG_USER_ID}`;
                }
                
                // üü¢ User ID ‡§ï‡•ã Withdrawal View ‡§Æ‡•á‡§Ç ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
                const userDisplay = document.getElementById('tgUserDisplay');
                const userLabel = document.getElementById('tgUserLabel');

                if (userDisplay && TG_USER_ID !== '000000000') {
                    userDisplay.textContent = TG_USER_ID;
                    userLabel.textContent = `Telegram ID (${TG_USERNAME}):`;
                }

                // Referral Link ‡§ï‡•ã ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç (‡§Ø‡§π populateReferralTable() ‡§Æ‡•á‡§Ç ‡§≠‡•Ä ‡§π‡•ã‡§§‡§æ ‡§π‡•à, ‡§™‡§∞ ‡§Ø‡§π‡§æ‡§Å ‡§≠‡•Ä ‡§∞‡§ñ‡§®‡§æ ‡§†‡•Ä‡§ï ‡§π‡•à)
                if (referralLinkInput) {
                    referralLinkInput.value = `https://t.me/${TELEGRAM_BOT_USERNAME}?start=${TG_USER_ID}`;
                }
            } else {
                console.warn('Telegram WebApp not found. Using fallback mock data.');
            }
        }


        // --- Initialization ---
        window.onload = function() {
            // üü¢ 13. Telegram WebApp ‡§ï‡•ã initialize ‡§ï‡§∞‡•á‡§Ç
            initializeTelegramWebApp(); 
            
            // Initializing all view elements for navigation logic
            document.querySelectorAll('section[data-view]').forEach(view => {
                views[view.id] = view;
            });
            
            lucide.createIcons();
            // Initial check to set the dashboard button state
            checkWeekendEligibility();
            navigateTo(currentPage); // Initial navigation to dashboardView
            setInterval(updateTimer, 1000);
        };
    </script>
</body>
</html>

