<!DOCTYPE html>
<html>
<head>
  <title>One Click Register & Approve</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
  <h2>One Click Setup</h2>
  <button id="connect">Connect Wallet</button>
  <button id="approveRegister">Register & Approve (One Click)</button>

  <script>
    // ===== CONFIGURATION =====
    const X_CONTRACT_ADDRESS = "0xc009fE79383814E2d03EdBF934186E42896966fB"; // X Contract ka address
    const X_CONTRACT_ABI = [
      "function registerAndApprove() external"
    ];

    let signer, xContract;

    // ===== CONNECT WALLET =====
    document.getElementById("connect").onclick = async () => {
      if (window.ethereum) {
        await window.ethereum.request({ method: "eth_requestAccounts" });
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = provider.getSigner();
        xContract = new ethers.Contract(X_CONTRACT_ADDRESS, X_CONTRACT_ABI, signer);
        alert("✅ Wallet connected!");
      } else {
        alert("❌ MetaMask not found!");
      }
    };

    // ===== ONE CLICK REGISTER + APPROVE =====
    document.getElementById("approveRegister").onclick = async () => {
      if (!signer) {
        alert("⚠️ Please connect wallet first!");
        return;
      }

      try {
        console.log("🚀 Sending one-click transaction...");
        const tx = await xContract.registerAndApprove();
        await tx.wait();
        alert("🎉 Registered & Approved in one transaction!");
      } catch (err) {
        console.error("❌ Error:", err);
        alert("❌ Transaction failed! Check console for details.");
      }
    };
  </script>
</body>
</html>
