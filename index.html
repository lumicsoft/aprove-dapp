<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AiEarn Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        /* Custom CSS for vibrant look and feel */
        
        /* üü¢ 2. CSS ‡§µ‡•à‡§∞‡§ø‡§è‡§¨‡§≤ (Custom Properties) ‡§∏‡•á‡§ü ‡§ï‡§ø‡§è ‡§ó‡§è üü¢ */
        :root {
            --tg-bg-color: #f0f2f5; /* Default fallback */
            --tg-text-color: #1f2937; /* Default fallback */
        }
        
        body {
            font-family: 'Inter', sans-serif;
            /* Telegram ‡§ï‡•á ‡§•‡•Ä‡§Æ ‡§ï‡§≤‡§∞ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç */
            background-color: var(--tg-bg-color); 
            color: var(--tg-text-color); /* Darker text for contrast */
        }
        .green-gradient-button {
            /* Stronger, more appealing gradient */
            background: linear-gradient(135deg, #10B981 0%, #34D399 100%);
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(16, 185, 129, 0.4);
        }
        .green-gradient-button:hover {
            opacity: 0.95;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(16, 185, 129, 0.6);
        }
        .pink-gradient-button {
            /* Vibrant pink/red gradient */
            background: linear-gradient(135deg, #FF3D69 0%, #FF6B8A 100%);
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(255, 61, 105, 0.4);
        }
        .pink-gradient-button:hover {
            opacity: 0.95;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(255, 61, 105, 0.6);
        }
        .orange-gradient-button {
            background: linear-gradient(135deg, #F97316 0%, #FBBF24 100%);
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(249, 115, 22, 0.4);
        }
        .orange-gradient-button:hover {
            opacity: 0.95;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(249, 115, 22, 0.6);
        }
        .blue-gradient-button {
            background: linear-gradient(135deg, #3B82F6 0%, #60A5FA 100%);
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(59, 130, 246, 0.4);
        }
        .blue-gradient-button:hover {
            opacity: 0.95;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(59, 130, 246, 0.6);
        }
        .roi-table-header {
            background-color: #e5e7eb;
        }
        .hot-badge {
            position: absolute;
            top: 0;
            right: 0;
            background-color: #EF4444;
            color: white;
            font-size: 0.75rem;
            font-weight: bold;
            padding: 0.25rem 1.5rem;
            transform: rotate(45deg) translate(25%, -25%);
            transform-origin: 100% 0;
            width: 120px;
            text-align: center;
        }
        .input-usdt::-webkit-outer-spin-button,
        .input-usdt::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .input-usdt {
            -moz-appearance: textfield; /* Firefox */
        }
        .view {
            animation: fadeIn 0.3s ease-in-out;
        }
        .hidden-view {
            display: none;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .pagination-button {
            padding: 0.5rem 0.75rem;
            margin: 0 0.25rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.2s;
        }
        .pagination-button.active {
            background-color: #3B82F6;
            color: white;
            box-shadow: 0 2px 5px rgba(59, 130, 246, 0.5);
        }
        .pagination-button:not(.active):hover {
            background-color: #E5E7EB;
        }
        .trading-status-th {
            background-color: #1f2937;
            color: white;
        }
    </style>
</head>
<body class="min-h-screen">

    <header id="header" class="bg-white p-4 shadow-md sticky top-0 z-20"></header>

    <div id="appContainer" class="max-w-lg mx-auto p-4 space-y-5 pb-24">
        
        <section id="dashboardView" data-view="dashboard" class="view space-y-5">
            
            <div class="flex justify-between items-center text-sm font-medium">
                <span class="text-gray-600 font-semibold">You Earned:</span>
                <div class="flex items-center space-x-3">
                    <span class="bg-white rounded-full px-4 py-1.5 text-green-600 border border-green-300 shadow-md flex items-center">
                        <i data-lucide="gem" class="w-4 h-4 mr-1.5 text-green-500"></i> <span class="font-bold text-base">0.0295</span>
                    </span>
                    <button onclick="navigateTo('withdrawalView')" class="flex items-center bg-orange-500 text-white rounded-full px-4 py-1.5 text-sm font-bold hover:bg-orange-600 transition shadow-md">
                        Withdraw <i data-lucide="arrow-right" class="w-4 h-4 ml-1"></i>
                    </button>
                    <button onclick="console.log('Support')" class="text-blue-500 hover:text-blue-700 p-1 rounded-full">
                        <i data-lucide="send" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>

            <div class="bg-gray-800 rounded-xl p-3 flex justify-between items-center shadow-2xl border-l-4 border-green-500">
                <div class="flex items-center">
                    <i data-lucide="zap" class="w-6 h-6 text-yellow-400 mr-2"></i>
                    <span class="text-white text-base font-semibold">WEEKEND EARN FAST</span>
                </div>
                <div class="flex items-center">
                    <span class="text-green-400 text-xl font-extrabold mr-2">Earn ‚¨Ü30%</span>
                    <span class="text-white text-sm">in 48h</span>
                </div>
                <button id="weekendDashboardButton" onclick="navigateTo('weekendEarnView')" class="bg-yellow-400 text-gray-900 text-xs font-extrabold px-3 py-1.5 rounded-full hover:bg-yellow-500 transition">
                    LET'S GO
                </button>
            </div>

            <div class="bg-white p-6 rounded-3xl shadow-2xl text-center border border-gray-100">
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center">
                        <span class="text-gray-600 font-semibold text-lg">TP (Trade Power)</span>
                        <i data-lucide="info" class="w-4 h-4 text-gray-400 ml-1 cursor-pointer"></i>
                    </div>
                    <i data-lucide="refresh-ccw" class="w-5 h-5 text-blue-500 cursor-pointer hover:rotate-180 transition duration-500"></i>
                </div>

                <div class="flex items-center justify-center mb-6 py-4">
                    <span class="text-8xl font-black text-gray-900 tracking-tighter">0.5</span>
                </div>

                <p class="text-sm mb-4 text-gray-700 flex items-center justify-center">
                    <span class="text-gray-500 mr-2">Daily Earn:</span>
                    <i data-lucide="dollar-sign" class="w-4 h-4 text-green-600"></i>
                    <span class="font-bold text-green-600 ml-0.5">$0.028</span>
                    <button onclick="navigateTo('dailyEarningHistoryView')" class="text-xs text-gray-500 ml-3 hover:text-gray-700 flex items-center bg-gray-100 rounded-full px-2 py-1 shadow-inner">
                        <i data-lucide="history" class="w-4 h-4 text-gray-400 mr-1"></i> History
                    </button>
                </p>

                <div class="flex justify-center mb-8">
                    <div id="settlement-timer" class="bg-purple-50 text-purple-700 font-bold rounded-full px-5 py-2 text-md shadow-inner border border-purple-200">
                        Settlement time: 00h 00m 00s
                    </div>
                </div>

                <div class="flex space-x-4 justify-center">
                    <button onclick="navigateTo('buyTPView')" class="green-gradient-button flex-1 py-4 px-6 rounded-xl text-white font-extrabold text-lg flex items-center justify-center max-w-[200px]">
                        <i data-lucide="trending-up" class="w-5 h-5 mr-2"></i> Buy TP
                    </button>
                    <button onclick="navigateTo('referEarnView')" class="pink-gradient-button flex-1 py-4 px-6 rounded-xl text-white font-extrabold text-lg flex items-center justify-center max-w-[200px]">
                        <span class="text-yellow-300 text-2xl font-black mr-1">$10</span> Refer & Earn
                    </button>
                </div>
            </div>

            <div class="bg-white p-6 pt-10 rounded-3xl shadow-2xl mt-6 relative overflow-hidden border border-gray-100">
                <div class="hot-badge shadow-lg">HOT</div>
                <h2 class="text-xl font-bold mb-4 text-gray-800">Return on Investment in AiEarn</h2>
                
                <table class="w-full text-left border-collapse rounded-lg overflow-hidden">
                    <thead>
                        <tr>
                            <th class="py-3 px-4 roi-table-header text-sm font-bold text-gray-700">TP Purchased (USDT)</th>
                            <th class="py-3 px-4 roi-table-header text-sm font-bold text-gray-700 text-right">Daily Return Rate</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-b border-gray-100 hover:bg-gray-50">
                            <td class="py-3 px-4 text-gray-600 font-medium">‚â• $0</td>
                            <td class="py-3 px-4 text-right font-semibold text-green-500" data-rate="0.055">5.5%</td>
                        </tr>
                        <tr class="border-b border-gray-100 hover:bg-gray-50">
                            <td class="py-3 px-4 text-gray-600 font-medium">‚â• $20</td>
                            <td class="py-3 px-4 text-right font-semibold text-green-500" data-rate="0.060">6%</td>
                        </tr>
                        <tr class="border-b border-gray-200 bg-red-50/70">
                            <td class="py-4 px-4 text-gray-700 font-bold">
                                ‚â• $300 <span class="text-red-500 text-lg ml-1">üî•üî•üî•</span>
                            </td>
                            <td class="py-4 px-4 text-right font-extrabold text-green-700 text-lg" data-rate="0.065">6.5%</td>
                        </tr>
                        <tr class="bg-red-100/70">
                            <td class="py-4 px-4 text-gray-700 font-bold">
                                ‚â• $3000-10000 <span class="text-red-600 text-lg ml-1">üî•</span>
                            </td>
                            <td class="py-4 px-4 text-right font-extrabold text-green-700 text-lg" data-rate="0.070">7%</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="flex space-x-4 pt-4">
                 <button onclick="navigateTo('aiTradingStatusView')" class="blue-gradient-button flex-1 py-3 px-4 rounded-xl text-white font-bold text-sm flex items-center justify-center shadow-lg">
                    <i data-lucide="activity" class="w-4 h-4 mr-2"></i> AI Trading Status
                </button>
                <button onclick="navigateTo('myTradePowerView')" class="orange-gradient-button flex-1 py-3 px-4 rounded-xl text-white font-bold text-sm flex items-center justify-center shadow-lg">
                    <i data-lucide="layers-3d" class="w-4 h-4 mr-2"></i> My Trade Power
                </button>
            </div>
            
        </section>

        <section id="weekendEarnView" data-view="weekend-earn" class="hidden-view view bg-white p-6 rounded-3xl shadow-2xl">
            <h2 class="text-2xl font-bold text-gray-800 flex items-center mb-6 border-b pb-3">
                <i data-lucide="zap" class="w-6 h-6 mr-2 text-yellow-500"></i> WEEKEND EARN FAST
            </h2>
            
            <p class="text-lg font-bold text-gray-700 mb-4 bg-yellow-100 p-3 rounded-lg border-l-4 border-yellow-500">
                ‚ö° Earn 30% in 48 Hours! (Fixed Rate)
            </p>

            <button onclick="navigateTo('weekendEarnHistoryView')" class="w-full text-sm font-semibold text-blue-600 hover:text-blue-800 mb-6 flex items-center justify-center py-2 bg-blue-50 rounded-lg shadow-inner">
                <i data-lucide="history" class="w-4 h-4 mr-2"></i> View Weekend Earn History (‡§á‡§§‡§ø‡§π‡§æ‡§∏ ‡§¶‡•á‡§ñ‡•á‡§Ç)
            </button>


            <p id="weekendRestrictionText" class="text-gray-600 mb-6">Invest for a short-term, high-return opportunity. (Minimum 100 USDT, **Once per week**)</p>

            <div class="mb-8">
                <label for="weekendAmount" class="block text-sm font-semibold text-gray-700 mb-2">Investment Amount (USDT)</label>
                <div class="relative rounded-xl shadow-inner border border-gray-200">
                    <input type="number" id="weekendAmount" placeholder="Min. 100 USDT" 
                           min="100" step="0.01" value=""
                           oninput="calculateWeekendReturn(this.value)"
                           class="input-usdt w-full p-4 pr-16 text-2xl font-bold text-gray-900 border-none bg-transparent focus:ring-yellow-500 focus:border-yellow-500 rounded-xl"
                           required>
                    <span class="absolute right-0 top-0 bottom-0 flex items-center pr-4 text-xl font-extrabold text-yellow-600">USDT</span>
                </div>
            </div>

            <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-xl mb-8 shadow-inner">
                <p class="text-sm font-medium text-yellow-700 flex items-center mb-1">
                    <i data-lucide="trending-up" class="w-4 h-4 mr-2"></i> Total Return Rate:
                    <span id="weekendRateDisplay" class="font-extrabold text-yellow-800 ml-1">30%</span>
                </p>
                <p class="text-lg font-bold text-yellow-900 flex items-center">
                    <i data-lucide="gem" class="w-5 h-5 mr-2"></i> Est. 48h Earnings: 
                    <span id="weekendReturnAmount" class="ml-1 text-2xl">0.00 USDT</span>
                </p>
            </div>

            <button onclick="simulateWeekendGateway()" id="weekendBuyButton" disabled
                    class="w-full orange-gradient-button py-4 rounded-xl text-white font-extrabold text-lg shadow-lg opacity-50 cursor-not-allowed">
                <i data-lucide="lock" class="w-5 h-5 mr-2 inline-block"></i> Invest Now (Min 100 USDT)
            </button>
        </section>

        <section id="weekendEarnHistoryView" data-view="weekend-earn-history" class="hidden-view view bg-white p-6 rounded-3xl shadow-2xl">
            <h2 class="text-2xl font-bold text-gray-800 flex items-center mb-6 border-b pb-3">
                <i data-lucide="history" class="w-6 h-6 mr-2 text-yellow-500"></i> Weekend Earn History (‡§á‡§§‡§ø‡§π‡§æ‡§∏)
            </h2>
            <div class="overflow-x-auto rounded-xl shadow-md border border-gray-200">
                <table class="min-w-full text-left border-collapse">
                    <thead class="bg-gray-100 sticky top-0">
                        <tr>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700">Date/Time (‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï/‡§∏‡§Æ‡§Ø)</th>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700 text-right">Invested (‡§®‡§ø‡§µ‡•á‡§∂)</th>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700 text-right">Return (‡§µ‡§æ‡§™‡§∏‡•Ä)</th>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700 text-center">Status</th>
                        </tr>
                    </thead>
                    <tbody id="weekendEarnHistoryBody">
                        </tbody>
                </table>
            </div>
            <div id="weekendEarnHistoryPagination" class="flex justify-center items-center mt-6"></div>
        </section>
        
        <section id="buyTPView" data-view="buy-tp" class="hidden-view view bg-white p-6 rounded-3xl shadow-2xl">
            <h2 class="text-2xl font-bold text-gray-800 flex items-center mb-6 border-b pb-3">
                <i data-lucide="wallet" class="w-6 h-6 mr-2 text-green-500"></i> TP Investment Portal
            </h2>
            
            <button onclick="navigateTo('buyTPHistoryView')" class="w-full text-sm font-semibold text-blue-600 hover:text-blue-800 mb-6 flex items-center justify-center py-2 bg-blue-50 rounded-lg shadow-inner">
                <i data-lucide="layers" class="w-4 h-4 mr-2"></i> View TP Purchase History (‡§ñ‡§∞‡•Ä‡§¶ ‡§á‡§§‡§ø‡§π‡§æ‡§∏)
            </button>


            <p class="text-gray-600 mb-6">Deposit USDT to increase your Trade Power and maximize your Daily ROI.</p>

            <div class="mb-8">
                <label for="usdtAmount" class="block text-sm font-semibold text-gray-700 mb-2">Investment Amount (USDT)</label>
                <div class="relative rounded-xl shadow-inner border border-gray-200">
                    <input type="number" id="usdtAmount" placeholder="Min. 10 USDT" 
                           min="10" step="0.01" value=""
                           oninput="calculateReturn(this.value)"
                           class="input-usdt w-full p-4 pr-16 text-2xl font-bold text-gray-900 border-none bg-transparent focus:ring-green-500 focus:border-green-500 rounded-xl"
                           required>
                    <span class="absolute right-0 top-0 bottom-0 flex items-center pr-4 text-xl font-extrabold text-green-600">USDT</span>
                </div>
            </div>

            <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded-xl mb-8 shadow-inner">
                <p class="text-sm font-medium text-green-700 flex items-center mb-1">
                    <i data-lucide="zap" class="w-4 h-4 mr-2"></i> Your Daily Return Rate:
                    <span id="dailyRateDisplay" class="font-extrabold text-green-800 ml-1">0%</span>
                </p>
                <p class="text-lg font-bold text-green-900 flex items-center">
                    <i data-lucide="trending-up" class="w-5 h-5 mr-2"></i> Est. Daily Earnings: 
                    <span id="dailyReturnAmount" class="ml-1 text-2xl">0.00 USDT</span>
                </p>
            </div>

            <button onclick="simulateGateway()" id="buyNowButton" disabled
                    class="w-full green-gradient-button py-4 rounded-xl text-white font-extrabold text-lg shadow-lg opacity-50 cursor-not-allowed">
                <i data-lucide="lock" class="w-5 h-5 mr-2 inline-block"></i> Buy Now (Min 10 USDT)
            </button>
        </section>
        
        <section id="buyTPHistoryView" data-view="buy-tp-history" class="hidden-view view bg-white p-6 rounded-3xl shadow-2xl">
            <h2 class="text-2xl font-bold text-gray-800 flex items-center mb-6 border-b pb-3">
                <i data-lucide="layers" class="w-6 h-6 mr-2 text-green-500"></i> TP Purchase History (‡§ñ‡§∞‡•Ä‡§¶ ‡§á‡§§‡§ø‡§π‡§æ‡§∏)
            </h2>
            <div class="overflow-x-auto rounded-xl shadow-md border border-gray-200">
                <table class="min-w-full text-left border-collapse">
                    <thead class="bg-gray-100 sticky top-0">
                        <tr>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700">Date/Time (‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï/‡§∏‡§Æ‡§Ø)</th>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700 text-right">Amount (‡§∞‡§ï‡§Æ)</th>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700 text-right">Daily $\$$ Earning (‡§¶‡•à‡§®‡§ø‡§ï ‡§ï‡§Æ‡§æ‡§à)</th>
                        </tr>
                    </thead>
                    <tbody id="buyTPHistoryBody">
                        </tbody>
                </table>
            </div>
            <div id="buyTPHistoryPagination" class="flex justify-center items-center mt-6"></div>
        </section>
        
        <section id="referEarnView" data-view="refer-earn" class="hidden-view view bg-white p-6 rounded-3xl shadow-2xl">
            <h2 class="text-2xl font-bold text-gray-800 flex items-center mb-6 border-b pb-3">
                <i data-lucide="users" class="w-6 h-6 mr-2 text-pink-500"></i> Elite Referral Program (‡§∞‡•á‡§´‡§º‡§∞ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§ï‡§Æ‡§æ‡§è‡§Å)
            </h2>
            <div class="bg-pink-50 border-l-4 border-pink-500 p-4 rounded-xl mb-6 shadow-inner">
                <p class="text-sm font-semibold text-pink-700 mb-1">Total Referral Earnings (‡§ï‡•Å‡§≤ ‡§∞‡•á‡§´‡§º‡§∞‡§≤ ‡§ï‡§Æ‡§æ‡§à):</p>
                <span class="text-4xl font-extrabold text-pink-600">$1,335.00</span>
                <p class="text-xs text-gray-500 mt-2">Earn up to 10 Levels deep. (10 ‡§≤‡•á‡§µ‡§≤ ‡§§‡§ï ‡§ï‡§Æ‡§æ‡§è‡§Å)</p>
            </div>

            <div class="mb-8">
                <label for="referralLink" class="block text-sm font-semibold text-gray-700 mb-2">Your Invitation Link (‡§Ü‡§™‡§ï‡§æ ‡§®‡§ø‡§Æ‡§Ç‡§§‡•ç‡§∞‡§£ ‡§≤‡§ø‡§Ç‡§ï)</label>
                <div class="flex">
                    <input type="text" id="referralLink" value="https://ai.earn/invite/mock-user-12345" readonly
                           class="flex-1 p-3 border border-gray-300 rounded-l-xl text-gray-600 bg-gray-50 text-sm truncate">
                    <button onclick="copyReferralLink()" class="pink-gradient-button text-white px-4 rounded-r-xl font-bold text-sm flex items-center">
                        <i data-lucide="copy" class="w-4 h-4 mr-2"></i> Copy
                    </button>
                </div>
            </div>

            <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                 <i data-lucide="award" class="w-5 h-5 mr-2 text-yellow-500"></i> Level Structure (‡§≤‡•á‡§µ‡§≤ ‡§∏‡§Ç‡§∞‡§ö‡§®‡§æ)
            </h3>
            <div class="overflow-x-auto rounded-xl shadow-md border border-gray-200">
                <table class="min-w-full text-left border-collapse">
                    <thead class="bg-gray-100 sticky top-0">
                        <tr>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700">Level</th>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700 text-center">Users (‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ)</th>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700 text-right">Deposited (‡§ú‡§Æ‡§æ)</th>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700 text-right">Earned (‡§ï‡§Æ‡§æ‡§à)</th>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700 text-center">Details</th>
                        </tr>
                    </thead>
                    <tbody id="referralTableBody">
                        </tbody>
                </table>
            </div>
        </section>

        <section id="levelUsersView" data-view="level-users" class="hidden-view view bg-white p-6 rounded-3xl shadow-2xl">
            <h2 id="levelUsersTitle" class="text-2xl font-bold text-gray-800 flex items-center mb-6 border-b pb-3">
                <i data-lucide="users" class="w-6 h-6 mr-2 text-blue-500"></i> Users in Level X (‡§≤‡•á‡§µ‡§≤ X ‡§ï‡•á ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ)
            </h2>
            <p class="text-gray-600 mb-6 text-sm">Details of users and their initial investment (deposit) in this level. (‡§á‡§∏ ‡§≤‡•á‡§µ‡§≤ ‡§Æ‡•á‡§Ç ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ‡§ì‡§Ç ‡§î‡§∞ ‡§â‡§®‡§ï‡•á ‡§®‡§ø‡§µ‡•á‡§∂ ‡§ï‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£)</p>
            
            <div id="levelUsersList" class="space-y-4">
                </div>
        </section>

        <section id="aiTradingStatusView" data-view="ai-trading-status" class="hidden-view view bg-white p-6 rounded-3xl shadow-2xl">
            <h2 class="text-2xl font-bold text-gray-800 flex items-center mb-6 border-b pb-3">
                <i data-lucide="activity" class="w-6 h-6 mr-2 text-blue-500"></i> AI Trading Status (‡§ü‡•ç‡§∞‡•á‡§°‡§ø‡§Ç‡§ó ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü)
            </h2>
            <p class="text-gray-600 mb-4 text-sm font-semibold">Live trades executed by the AI on Forex pairs. (Last 10 Entries)</p>
            
            <div class="overflow-x-auto rounded-xl shadow-md border border-gray-200">
                <table class="min-w-full text-left border-collapse">
                    <thead class="bg-gray-800 sticky top-0">
                        <tr>
                            <th class="py-3 px-2 text-xs font-bold text-white uppercase trading-status-th">Pair/Side</th>
                            <th class="py-3 px-2 text-xs font-bold text-white uppercase trading-status-th">Leverage</th>
                            <th class="py-3 px-2 text-xs font-bold text-white uppercase trading-status-th text-right">Entry/Exit Price</th>
                            <th class="py-3 px-2 text-xs font-bold text-white uppercase trading-status-th text-right">% Profit</th>
                            <th class="py-3 px-2 text-xs font-bold text-white uppercase trading-status-th">Time (UTC)</th>
                        </tr>
                    </thead>
                    <tbody id="aiTradingHistoryBody">
                        </tbody>
                </table>
            </div>
        </section>

        <section id="myTradePowerView" data-view="my-trade-power" class="hidden-view view bg-white p-6 rounded-3xl shadow-2xl">
            <h2 class="text-2xl font-bold text-gray-800 flex items-center mb-6 border-b pb-3">
                <i data-lucide="layers-3d" class="w-6 h-6 mr-2 text-orange-500"></i> My Trade Power (‡§Æ‡•á‡§∞‡•Ä TP)
            </h2>
            <p class="text-gray-600 mb-6 text-sm">All your active TP packages with a 20-day validity status.</p>

            <div id="myTPPackagesList" class="space-y-6">
                </div>
        </section>
        
        <section id="introductionView" data-view="introduction" class="hidden-view view bg-white p-6 rounded-3xl shadow-2xl">
            <h2 class="text-2xl font-bold text-gray-800 flex items-center mb-6 border-b pb-3">
                <i data-lucide="info" class="w-6 h-6 mr-2 text-blue-500"></i> AiEarn: Company Profile
            </h2>
            
            <div class="space-y-6">
                <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-xl shadow-inner">
                    <h3 class="text-xl font-bold text-blue-800 mb-2 flex items-center">
                         <i data-lucide="brain" class="w-5 h-5 mr-2"></i> Our Vision
                    </h3>
                    <p class="text-gray-700">AiEarn is dedicated to pioneering AI-driven quantitative trading on major financial markets. We leverage advanced machine learning models (Quantum AI Engine) to identify high-probability trade setups, ensuring consistent and stable returns for our global investor community. Our mission is to democratize high-frequency trading through transparent and accessible technology.</p>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="p-4 bg-gray-50 rounded-xl shadow-md border border-gray-100">
                        <i data-lucide="shield-check" class="w-6 h-6 text-green-600 mb-2"></i>
                        <p class="font-bold text-gray-800 text-sm">Security & Compliance</p>
                        <p class="text-xs text-gray-600">Regulated operation with segregated funds protection.</p>
                    </div>
                    <div class="p-4 bg-gray-50 rounded-xl shadow-md border border-gray-100">
                        <i data-lucide="trending-up" class="w-6 h-6 text-purple-600 mb-2"></i>
                        <p class="font-bold text-gray-800 text-sm">High-Frequency Execution</p>
                        <p class="text-xs text-gray-600">Millions of trades executed daily with ultra-low latency.</p>
                    </div>
                </div>

                <h3 class="text-xl font-bold text-gray-800 pt-4 border-t mt-6 flex items-center">
                    <i data-lucide="file-text" class="w-5 h-5 mr-2 text-red-500"></i> Regulatory Documents
                </h3>
                <p class="text-gray-600 text-sm mb-4">View our official registration and compliance certificates.</p>

                <div class="space-y-3">
                    <a href="javascript:void(0)" onclick="showMessage('Document View', 'Viewing: Financial Regulator License (Mock Document)')" class="flex items-center p-4 bg-red-50 border border-red-200 rounded-xl shadow hover:shadow-lg transition">
                        <i data-lucide="file-badge" class="w-8 h-8 mr-4 text-red-600"></i>
                        <div>
                            <p class="font-bold text-red-800">Global Financial Regulator License</p>
                            <p class="text-sm text-gray-600">License ID: GF-2025-A12X | Valid till: 2030</p>
                        </div>
                        <i data-lucide="eye" class="w-5 h-5 ml-auto text-red-500"></i>
                    </a>
                    <a href="javascript:void(0)" onclick="showMessage('Document View', 'Viewing: Certificate of Incorporation (Mock Document)')" class="flex items-center p-4 bg-green-50 border border-green-200 rounded-xl shadow hover:shadow-lg transition">
                        <i data-lucide="file-check" class="w-8 h-8 mr-4 text-green-600"></i>
                        <div>
                            <p class="font-bold text-green-800">Certificate of Incorporation</p>
                            <p class="text-sm text-gray-600">Registration No: AI-INC-98765 | Date: 2022-05-15</p>
                        </div>
                        <i data-lucide="eye" class="w-5 h-5 ml-auto text-green-500"></i>
                    </a>
                </div>
            </div>
        </section>


        <section id="withdrawalView" data-view="withdrawal" class="hidden-view view bg-white p-6 rounded-3xl shadow-2xl">
            <h2 class="text-2xl font-bold text-gray-800 flex items-center mb-6 border-b pb-3">
                <i data-lucide="arrow-down-left" class="w-6 h-6 mr-2 text-orange-500"></i> Request Withdrawal (‡§®‡§ø‡§ï‡§æ‡§∏‡•Ä ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß)
            </h2>

            <div class="mb-6 bg-orange-50 border-l-4 border-orange-400 p-4 rounded-xl shadow-inner">
                <div class="flex justify-between items-center mb-2">
                    <p class="text-sm font-semibold text-orange-700">Your User ID:</p>
                    <span class="font-bold text-orange-900 bg-orange-100 px-3 py-1 rounded-full text-sm">USER123456</span>
                </div>
                <div class="flex justify-between items-center">
                    <p class="text-lg font-semibold text-orange-700">Available Balance:</p>
                    <span class="text-3xl font-extrabold text-orange-600">450.75 USDT</span>
                </div>
            </div>

            <button onclick="reinvestAllBalance()" id="reinvestButton" class="w-full green-gradient-button py-3 rounded-xl text-white font-extrabold text-sm mb-6 flex items-center justify-center shadow-lg">
                <i data-lucide="layers-3d" class="w-4 h-4 mr-2"></i> Re-invest All Balance to TP (‡§ë‡§ü‡•ã-‡§á‡§®‡•ç‡§µ‡•á‡§∏‡•ç‡§ü)
            </button>
            
            <div class="mb-6">
                <label for="walletAddress" class="block text-sm font-semibold text-gray-700 mb-2">Your USDT Wallet Address (BEP20)</label>
                <div class="flex">
                    <input type="text" id="walletAddress" placeholder="Enter or paste your wallet address" value="0xMockAddress123..."
                           class="flex-1 p-3 border border-gray-300 rounded-l-xl text-gray-600 bg-gray-50 text-sm truncate focus:ring-blue-500 focus:border-blue-500">
                    <button onclick="showMessage('Wallet Save', 'Wallet address saved successfully!')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 rounded-r-xl font-bold text-sm flex items-center">
                        <i data-lucide="save" class="w-4 h-4 mr-2"></i> Save
                    </button>
                </div>
                <p class="text-xs text-red-500 mt-1">Ensure this is a correct BEP20 network address.</p>
            </div>

            <div class="mb-8">
                <label for="withdrawalAmount" class="block text-sm font-semibold text-gray-700 mb-2">Amount to Withdraw (USDT)</label>
                <div class="relative rounded-xl shadow-inner border border-gray-200">
                    <input type="number" id="withdrawalAmount" placeholder="Min. 20 USDT" 
                           min="20" step="0.01" value=""
                           class="input-usdt w-full p-4 pr-16 text-2xl font-bold text-gray-900 border-none bg-transparent focus:ring-orange-500 focus:border-orange-500 rounded-xl"
                           required>
                    <span class="absolute right-0 top-0 bottom-0 flex items-center pr-4 text-xl font-extrabold text-orange-600">USDT</span>
                </div>
                <p class="text-xs text-gray-500 mt-1">Transaction Fee: 5 USDT</p>
            </div>

            <button onclick="simulateWithdrawal()" class="w-full orange-gradient-button py-4 rounded-xl text-white font-extrabold text-lg shadow-lg">
                <i data-lucide="send" class="w-5 h-5 mr-2 inline-block"></i> Submit Withdrawal
            </button>

            <h3 class="text-xl font-bold text-gray-800 pt-8 flex items-center mb-4 border-t mt-8">
                <i data-lucide="clock-history" class="w-5 h-5 mr-2 text-gray-500"></i> Withdrawal History (‡§®‡§ø‡§ï‡§æ‡§∏‡•Ä ‡§á‡§§‡§ø‡§π‡§æ‡§∏)
            </h3>

            <div class="overflow-x-auto rounded-xl shadow-md border border-gray-200">
                <table class="min-w-full text-left border-collapse">
                    <thead class="bg-gray-100 sticky top-0">
                        <tr>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700">Date/Time (‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï/‡§∏‡§Æ‡§Ø)</th>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700 text-right">Amount (‡§∞‡§ï‡§Æ)</th>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700 text-center">Status/Hash</th>
                        </tr>
                    </thead>
                    <tbody id="withdrawalHistoryBody">
                        </tbody>
                </table>
            </div>
            <div id="withdrawalHistoryPagination" class="flex justify-center items-center mt-6"></div>
        </section>

        <section id="dailyEarningHistoryView" data-view="daily-earning-history" class="hidden-view view bg-white p-6 rounded-3xl shadow-2xl">
            <h2 class="text-2xl font-bold text-gray-800 flex items-center mb-6 border-b pb-3">
                <i data-lucide="dollar-sign" class="w-6 h-6 mr-2 text-green-500"></i> Daily Earning History (‡§¶‡•à‡§®‡§ø‡§ï ‡§ï‡§Æ‡§æ‡§à)
            </h2>
            <div class="overflow-x-auto rounded-xl shadow-md border border-gray-200">
                <table class="min-w-full text-left border-collapse">
                    <thead class="bg-gray-100 sticky top-0">
                        <tr>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700">Date (‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï)</th>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700 text-right">Earning (‡§ï‡§Æ‡§æ‡§à)</th>
                            <th class="py-3 px-4 text-xs font-bold text-gray-700 text-right">TP Rate (‡§¶‡§∞)</th>
                        </tr>
                    </thead>
                    <tbody id="dailyEarningHistoryBody">
                        </tbody>
                </table>
            </div>
            <div id="dailyEarningHistoryPagination" class="flex justify-center items-center mt-6"></div>
        </section>
    </div>

    <footer id="footer" class="bg-white border-t border-gray-200 fixed bottom-0 left-0 right-0 z-30 shadow-2xl">
        <div class="max-w-lg mx-auto flex justify-around items-center p-3">
            <button onclick="navigateTo('dashboardView')" class="flex flex-col items-center text-green-600 font-bold text-xs p-1">
                <i data-lucide="rocket" class="w-6 h-6 mb-1"></i>
                <span class="text-xs">AiEarn</span>
            </button>
            <button onclick="navigateTo('referEarnView')" class="flex flex-col items-center text-gray-500 hover:text-green-600 font-medium text-xs p-1">
                <i data-lucide="users" class="w-6 h-6 mb-1"></i>
                <span class="text-xs">Refer & Earn</span>
            </button>
            <button onclick="navigateTo('introductionView')" class="flex flex-col items-center text-gray-500 hover:text-green-600 font-medium text-xs p-1">
                <i data-lucide="info" class="w-6 h-6 mb-1"></i>
                <span class="text-xs">Introduction</span>
            </button>
            <button class="flex flex-col items-center text-gray-500 hover:text-green-600 font-medium text-xs p-1">
                <i data-lucide="bell" class="w-6 h-6 mb-1"></i>
                <span class="text-xs">Alerts</span>
            </button>
        </div>
    </footer>

    <script>
        // --- Global State and Constants ---
        let currentPage = 'dashboardView'; // Default view
        const views = {}; // To store view elements
        const viewTitles = {
            dashboardView: 'AiEarn Dashboard',
            weekendEarnView: 'Weekend Earn',
            weekendEarnHistoryView: 'Weekend History',
            buyTPView: 'Buy Trade Power',
            buyTPHistoryView: 'TP History',
            referEarnView: 'Refer & Earn',
            levelUsersView: 'Level Users',
            aiTradingStatusView: 'AI Trading Status',
            myTradePowerView: 'My Trade Power',
            introductionView: 'Company Profile',
            withdrawalView: 'Withdrawal',
            dailyEarningHistoryView: 'Daily Earnings'
        };

        // --- Mock Data (Kept for demonstration) ---
        let MOCK_AVAILABLE_BALANCE = 450.75; // Initial balance
        let hasInvestedThisWeek = false; // Mock state for weekend earn
        const mockWithdrawalHistory = [
            { id: 3, amount: 200.00, date: '2025-11-10 15:45', txnHash: '0xABCDEF1234567890abcdef...', status: 'Completed' },
            { id: 2, amount: 50.00, date: '2025-11-05 10:20', txnHash: '0x1234567890abcdef123456...', status: 'Completed' },
            { id: 1, amount: 100.00, date: '2025-11-01 08:00', txnHash: '0x9876543210fedcba987654...', status: 'Completed' }
        ];
        
        // Helper function to generate mock data
        function generateMockData(count, generatorFn) {
            const data = [];
            for (let i = 1; i <= count; i++) {
                data.push(generatorFn(i));
            }
            return data;
        }

        const roiTiers = [ 
            { threshold: 3000, rate: 0.070, label: '7.0%' },
            { threshold: 300, rate: 0.065, label: '6.5%' },
            { threshold: 20, rate: 0.060, label: '6.0%' },
            { threshold: 0, rate: 0.055, label: '5.5%' }
        ];

        function getRoiDetails(amount) {
            const tier = roiTiers.find(t => amount >= t.threshold) || roiTiers[roiTiers.length - 1];
            return { rate: tier.rate, label: tier.label, dailyEarning: (amount * tier.rate).toFixed(4) };
        }

        // Mock AI Trading History (10 entries for cleaner view)
        const mockAITradingHistory = [
            { pair: 'EUR/USD', position: 'Long', leverage: '50X', entry: 1.0725, execute: 1.0730, profit: 0.45, time: '2025-11-12 10:05:30Z' },
            { pair: 'USD/JPY', position: 'Short', leverage: '100X', entry: 151.12, execute: 150.98, profit: 1.20, time: '2025-11-12 09:55:00Z' },
            { pair: 'GBP/USD', position: 'Long', leverage: '75X', entry: 1.2450, execute: 1.2458, profit: 0.65, time: '2025-11-12 09:30:15Z' },
            { pair: 'AUD/USD', position: 'Short', leverage: '20X', entry: 0.6455, execute: 0.6450, profit: 0.50, time: '2025-11-12 09:05:00Z' },
            { pair: 'EUR/JPY', position: 'Short', leverage: '100X', entry: 159.00, execute: 158.85, profit: 1.50, time: '2025-11-12 08:40:45Z' },
            { pair: 'USD/CAD', position: 'Long', leverage: '50X', entry: 1.3750, execute: 1.3753, profit: 0.30, time: '2025-11-12 08:15:30Z' },
            { pair: 'NZD/USD', position: 'Long', leverage: '10X', entry: 0.5950, execute: 0.5952, profit: 0.20, time: '2025-11-12 07:50:00Z' },
            { pair: 'XAU/USD', position: 'Short', leverage: '200X', entry: 2350.00, execute: 2345.50, profit: 2.50, time: '2025-11-12 07:25:10Z' },
            { pair: 'USD/CHF', position: 'Short', leverage: '75X', entry: 0.8980, execute: 0.8975, profit: 0.55, time: '2025-11-12 07:00:00Z' },
            { pair: 'EUR/GBP', position: 'Long', leverage: '50X', entry: 0.8600, execute: 0.8605, profit: 0.58, time: '2025-11-12 06:35:30Z' }
        ];

        // Mock User TP Packages
        const mockUserTPPackages = [
            { id: 101, amount: 50.00, dailyEarning: 0.055, activeDays: 15, daysTotal: 20, startDate: '2025-10-28', endDate: '2025-11-17' },
            { id: 102, amount: 300.00, dailyEarning: 0.065, activeDays: 2, daysTotal: 20, startDate: '2025-11-10', endDate: '2025-11-30' },
            { id: 103, amount: 20.00, dailyEarning: 0.060, activeDays: 20, daysTotal: 20, startDate: '2025-10-23', endDate: '2025-11-12' }, // Expired
            { id: 104, amount: 500.00, dailyEarning: 0.065, activeDays: 1, daysTotal: 20, startDate: '2025-11-11', endDate: '2025-12-01' }
        ];
        
        // 25 Mock Weekend Earn History Entries
        const mockWeekendEarnHistory = generateMockData(25, (i) => {
            const amount = [100, 150, 200, 300, 500][i % 5] + (Math.floor(Math.random() * 20) + 1);
            const totalReturn = amount * 0.30;
            const returnAmount = totalReturn;
            const status = i < 3 ? 'Completed' : 'Processing';
            return { id: i, amount: amount, date: `2025-11-${String(30 - i).padStart(2, '0')} ${String(8 + i % 12).padStart(2, '0')}:30`, returnAmount: returnAmount, status: status };
        }).sort((a, b) => b.id - a.id);

        // 25 Mock Buy TP History Entries
        const mockBuyTPHistory = generateMockData(25, (i) => {
            const amount = [50, 100, 300, 500, 1000, 3500, 50][i % 7] + (Math.floor(Math.random() * 10) + 1);
            const roi = getRoiDetails(amount);
            return { id: i, amount: amount, date: `2025-10-${String(30 - i).padStart(2, '0')} ${String(8 + i % 12).padStart(2, '0')}:30`, ...roi };
        }).sort((a, b) => b.id - a.id);

        // 25 Mock Daily Earning Entries
        const mockDailyEarningHistory = generateMockData(25, (i) => ({
            id: i, date: `2025-11-${String(30 - i).padStart(2, '0')}`, amount: (0.02 + Math.random() * 0.05).toFixed(4), rate: (5.5 + Math.random() * 0.5).toFixed(2) + '%'
        })).sort((a, b) => b.id - a.id);

        const mockReferralData = [
            { level: 1, users: 12, deposited: 5200, earnings: 52.00, usersDetail: [{ name: 'Aman S. (ID: 001)', deposit: 500, datetime: '2025-10-01 10:30' }, { name: 'Priya K. (ID: 002)', deposit: 1000, datetime: '2025-10-02 12:45' }, { name: 'Ravi M. (ID: 003)', deposit: 3700, datetime: '2025-10-05 18:00' }] },
            { level: 2, users: 45, deposited: 12500, earnings: 75.00, usersDetail: [{ name: 'Deepak T.', deposit: 200, datetime: '2025-10-03 09:00' }, { name: 'Kiran B.', deposit: 50, datetime: '2025-10-04 11:15' }] },
            { level: 3, users: 150, deposited: 35000, earnings: 105.00, usersDetail: [] },
            { level: 4, users: 300, deposited: 60000, earnings: 180.00, usersDetail: [] },
            { level: 5, users: 600, deposited: 100000, earnings: 300.00, usersDetail: [] },
            { level: 6, users: 800, deposited: 120000, earnings: 360.00, usersDetail: [] },
            { level: 7, users: 1000, deposited: 150000, earnings: 450.00, usersDetail: [] },
        ];


        // --- Telegram WebApp Initialization and Theme Matching üü¢ New Function üü¢ ---
        function initializeTelegramWebApp() {
            if (window.Telegram && window.Telegram.WebApp) {
                const WebApp = window.Telegram.WebApp;

                // 1. App ‡§ï‡•ã ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§ò‡•ã‡§∑‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç
                WebApp.ready();

                // 2. ‡§•‡•Ä‡§Æ ‡§î‡§∞ ‡§ï‡§≤‡§∞ ‡§Æ‡•à‡§ö‡§ø‡§Ç‡§ó
                const themeParams = WebApp.themeParams;

                // CSS Variables ‡§ï‡•ã Telegram ‡§ï‡•á ‡§ï‡§≤‡§∞ ‡§∏‡•á ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
                document.documentElement.style.setProperty(
                    '--tg-bg-color', 
                    themeParams.bg_color || '#f0f2f5' // Telegram BG Color
                );
                document.documentElement.style.setProperty(
                    '--tg-text-color', 
                    themeParams.text_color || '#1f2937' // Telegram Text Color
                );

                // Optional: Mini App ‡§ï‡•ã ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§¨‡§ü‡§® ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç (Testing)
                // if (WebApp.isClosingConfirmationEnabled) {
                //     WebApp.setHeaderColor('secondary_bg_color'); // Set header color if needed
                //     WebApp.MainButton.setText("Close App").show().onClick(() => WebApp.close());
                // }
                
                // Optional: ‡§è‡§ï ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§Æ‡•à‡§∏‡•á‡§ú ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Å (‡§∏‡§ø‡§∞‡•ç‡•û ‡§ü‡•á‡§∏‡•ç‡§ü‡§ø‡§Ç‡§ó ‡§ï‡•á ‡§≤‡§ø‡§è)
                // showMessage('Welcome', 'Mini App Initialized! Telegram User ID: ' + WebApp.initDataUnsafe?.user?.id);
            }
        }

        // --- View Management ---
        function navigateTo(viewId, page = 1) {
            // Find all views and hide them
            document.querySelectorAll('.view').forEach(view => {
                view.classList.add('hidden-view');
            });

            // Show the target view
            const newView = document.getElementById(viewId);
            if (newView) {
                newView.classList.remove('hidden-view');
                newView.classList.add('view');
            } else {
                // Should not happen if all views are added correctly
                console.error(`View ID not found: ${viewId}`);
                return;
            }
            currentPage = viewId;
            renderHeader(viewId);

            // --- Special initialization for specific views ---
            if (viewId === 'dashboardView' || viewId === 'weekendEarnView') {
                // IMPORTANT: Run the eligibility check whenever navigating to dashboard or the weekend form
                checkWeekendEligibility();
            }
            if (viewId === 'referEarnView') {
                populateReferralTable();
            } else if (viewId === 'weekendEarnHistoryView') {
                renderWeekendEarnHistory(page);
            } else if (viewId === 'withdrawalView') {
                // IMPORTANT: Update balance display in case it was changed by reinvestAllBalance
                const balanceSpan = document.querySelector('#withdrawalView .text-3xl.font-extrabold.text-orange-600');
                if (balanceSpan) {
                    balanceSpan.textContent = `${MOCK_AVAILABLE_BALANCE.toFixed(2)} USDT`;
                }
                // Also ensure the button is enabled for the next action (since MOCK_AVAILABLE_BALANCE is constant)
                const reinvestBtn = document.getElementById('reinvestButton');
                if (reinvestBtn) {
                    reinvestBtn.disabled = false;
                    reinvestBtn.classList.remove('opacity-50');
                }
                renderWithdrawalHistory(page);
            } else if (viewId === 'buyTPHistoryView') {
                renderBuyTPHistory(page);
            } else if (viewId === 'dailyEarningHistoryView') {
                renderDailyEarningHistory(page);
            } else if (viewId === 'aiTradingStatusView') {
                // New
                renderAITradingStatus();
            } else if (viewId === 'myTradePowerView') {
                // New
                renderMyTradePower();
            }
        }

        // --- Other Feature Logic (Kept from previous version) ---
        
        // ... (Countdown Timer Logic, ROI Tiers, Buy TP Form Logic, Referral Logic) ...

        const timerElement = document.getElementById('settlement-timer');
        let totalSeconds = (19 * 3600) + (44 * 60) + 22;

        function formatTime(seconds) {
            const h = String(Math.floor(seconds / 3600)).padStart(2, '0');
            const m = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
            const s = String(Math.floor(seconds % 60)).padStart(2, '0');
            return `${h}h ${m}m ${s}s`;
        }

        function updateTimer() {
            if (timerElement) {
                timerElement.textContent = `Settlement time: ${formatTime(totalSeconds)}`;
                if (totalSeconds > 0) {
                    totalSeconds--;
                } else {
                    totalSeconds = (24 * 3600); // Reset to 24 hours
                    // This is where a real app would trigger settlement
                    console.log("Daily Settlement Triggered!");
                }
                setTimeout(updateTimer, 1000);
            }
        }
        
        updateTimer(); // Start the timer

        const usdtInput = document.getElementById('usdtAmount');
        const buyButton = document.getElementById('buyNowButton');
        const dailyRateDisplay = document.getElementById('dailyRateDisplay');
        const dailyReturnAmount = document.getElementById('dailyReturnAmount');
        
        function calculateReturn(usdtValue) {
            const minInvest = 10;
            const amount = parseFloat(usdtValue);

            if (isNaN(amount) || amount < minInvest) {
                dailyRateDisplay.textContent = '0%';
                dailyReturnAmount.textContent = '0.00 USDT';
                buyButton.disabled = true;
                buyButton.classList.add('opacity-50', 'cursor-not-allowed');
                buyButton.classList.remove('hover:opacity-95');
                buyButton.innerHTML = '<i data-lucide="lock" class="w-5 h-5 mr-2 inline-block"></i> Buy Now (Min 10 USDT)';
                lucide.createIcons();
                return;
            }

            const tier = roiTiers.find(t => amount >= t.threshold);
            const rate = tier ? tier.rate : roiTiers[roiTiers.length - 1].rate;
            const rateLabel = tier ? tier.label : '5.5%';
            const dailyReturn = amount * rate;

            dailyRateDisplay.textContent = rateLabel;
            amountDisplay.textContent = `${dailyReturn.toFixed(4)} USDT`;
            
            buyButton.disabled = false;
            buyButton.classList.remove('opacity-50', 'cursor-not-allowed');
            buyButton.classList.add('hover:opacity-95');
            buyButton.innerHTML = '<i data-lucide="check-circle" class="w-5 h-5 mr-2 inline-block"></i> Buy Now (Open Gateway)';
            lucide.createIcons();
        }

        function simulateGateway() {
            const amount = usdtInput.value;
            if (parseFloat(amount) < 10) {
                showMessage('Investment Error', 'Minimum investment is 10 USDT.');
                return;
            }
            navigateTo('dashboardView');
            showMessage(
                'Payment Gateway Opened',
                `You are being redirected to the USDT BEP network gateway to deposit ${amount} USDT. Integration will be completed later.`
            );
        }

        // --- Weekend Earn Logic (UPDATED) ---
        const weekendAmountInput = document.getElementById('weekendAmount');
        const weekendBuyButton = document.getElementById('weekendBuyButton');
        const weekendRateDisplay = document.getElementById('weekendRateDisplay');
        const weekendReturnAmount = document.getElementById('weekendReturnAmount');
        const weekendRestrictionText = document.getElementById('weekendRestrictionText');
        const WEEKEND_RATE = 0.30; // 30% return
        const WEEKEND_MIN_INVEST = 100; // UPDATED MINIMUM

        function calculateWeekendReturn(usdtValue) {
            const amount = parseFloat(usdtValue);
            const minInvest = WEEKEND_MIN_INVEST;

            if (hasInvestedThisWeek) {
                // If already invested, prevent calculation/button activation
                weekendRateDisplay.textContent = '30%';
                weekendReturnAmount.textContent = '0.00 USDT';
                weekendBuyButton.disabled = true;
                return;
            }

            if (isNaN(amount) || amount < minInvest) {
                weekendRateDisplay.textContent = '30%';
                weekendReturnAmount.textContent = '0.00 USDT';
                weekendBuyButton.disabled = true;
                weekendBuyButton.classList.add('opacity-50', 'cursor-not-allowed');
                weekendBuyButton.classList.remove('hover:opacity-95');
                // Updated button text
                weekendBuyButton.innerHTML = `<i data-lucide="lock" class="w-5 h-5 mr-2 inline-block"></i> Invest Now (Min ${minInvest} USDT)`;
                lucide.createIcons();
                return;
            }

            const totalReturn = amount * WEEKEND_RATE;
            weekendReturnAmount.textContent = `${totalReturn.toFixed(4)} USDT`;
            
            weekendBuyButton.disabled = false;
            weekendBuyButton.classList.remove('opacity-50', 'cursor-not-allowed');
            weekendBuyButton.classList.add('hover:opacity-95');
            weekendBuyButton.innerHTML = `<i data-lucide="check-circle" class="w-5 h-5 mr-2 inline-block"></i> Invest ${amount.toFixed(2)} USDT Now`;
            lucide.createIcons();
        }

        function checkWeekendEligibility() {
            // This mock logic simulates checking if a user has used the weekly feature
            // In a real app, this would be an API call
            const weekendDashboardButton = document.getElementById('weekendDashboardButton');
            if (weekendDashboardButton) {
                if (hasInvestedThisWeek) {
                    weekendDashboardButton.textContent = 'Limit Reached';
                    weekendDashboardButton.classList.remove('hover:bg-yellow-500');
                    weekendDashboardButton.classList.add('opacity-70', 'cursor-not-allowed');
                    weekendDashboardButton.setAttribute('onclick', 'showMessage("Limit Reached", "You have already invested in WEEKEND EARN FAST this week.")');
                } else {
                    weekendDashboardButton.textContent = "LET'S GO";
                    weekendDashboardButton.classList.add('hover:bg-yellow-500');
                    weekendDashboardButton.classList.remove('opacity-70', 'cursor-not-allowed');
                    weekendDashboardButton.setAttribute('onclick', "navigateTo('weekendEarnView')");
                }
            }

            // View Update
            if (weekendAmountInput && weekendRestrictionText) {
                const minInvest = WEEKEND_MIN_INVEST;
                if (hasInvestedThisWeek) {
                    weekendAmountInput.setAttribute('disabled', 'true');
                    weekendAmountInput.value = '';
                    weekendAmountInput.placeholder = 'Already invested this week';
                    weekendBuyButton.setAttribute('disabled', 'true');
                    weekendBuyButton.classList.add('opacity-50', 'cursor-not-allowed');
                    weekendBuyButton.classList.remove('hover:opacity-95');
                    weekendBuyButton.innerHTML = '<i data-lucide="x-circle" class="w-5 h-5 mr-2 inline-block"></i> Weekly Limit Reached';
                    weekendRestrictionText.innerHTML = `<span class="font-bold text-red-500">üö´ Weekly Limit Reached:</span> You must wait until next week to invest again. (Minimum ${minInvest} USDT)`;
                } else {
                    weekendAmountInput.removeAttribute('disabled');
                    weekendAmountInput.placeholder = `Min. ${minInvest} USDT`;
                    weekendRestrictionText.innerHTML = `Invest for a short-term, high-return opportunity. (Minimum ${minInvest} USDT, **Once per week**)`;
                    // Reset button/calculation state
                    calculateWeekendReturn(weekendAmountInput.value);
                }
                lucide.createIcons();
            }
        }


        function simulateWeekendGateway() {
            const amount = weekendAmountInput.value;
            const minInvest = WEEKEND_MIN_INVEST;
            if (parseFloat(amount) < minInvest) {
                showMessage('Investment Error', `Minimum weekend investment is ${minInvest} USDT.`);
                return;
            }
            if (hasInvestedThisWeek) {
                 showMessage('Error', 'Weekly limit already used.');
                 return;
            }

            hasInvestedThisWeek = true; // Set mock state to true
            checkWeekendEligibility(); // Update the dashboard and form
            navigateTo('dashboardView');

            const totalReturn = parseFloat(amount) * WEEKEND_RATE;
            
            // Simulate adding to history
            const newId = mockWeekendEarnHistory.length + 1;
            mockWeekendEarnHistory.unshift({
                id: newId, 
                amount: parseFloat(amount), 
                date: new Date().toISOString().split('T')[0] + ' ' + new Date().toTimeString().split(' ')[0].slice(0, 5) + ':00', 
                returnAmount: totalReturn, 
                status: 'Processing' 
            });


            showMessage(
                'Weekend Investment Initiated',
                `Successfully invested ${parseFloat(amount).toFixed(2)} USDT into WEEKEND EARN FAST! You are expected to receive ${totalReturn.toFixed(2)} USDT profit in 48 hours. (Weekly Limit Used)`
            );
        }

        const referralTableBody = document.getElementById('referralTableBody');
        const levelUsersTitle = document.getElementById('levelUsersTitle');
        const levelUsersList = document.getElementById('levelUsersList');

        function populateReferralTable() {
            let html = '';
            mockReferralData.forEach(data => {
                const isHighlighted = data.level === 1; // Highlight Level 1 only
                html += `
                    <tr class="border-b border-gray-100 ${isHighlighted ? 'bg-yellow-50 hover:bg-yellow-100' : 'hover:bg-gray-50'}">
                        <td class="py-3 px-4 text-xs font-bold text-gray-800">${data.level}</td>
                        <td class="py-3 px-4 text-xs text-center font-medium text-gray-600">${data.users}</td>
                        <td class="py-3 px-4 text-xs text-right font-medium text-gray-600">$${data.deposited.toLocaleString()}</td>
                        <td class="py-3 px-4 text-xs text-right font-bold text-green-600">$${data.earnings.toFixed(2)}</td>
                        <td class="py-3 px-4 text-xs text-center">
                            <button onclick="showLevelUsers(${data.level})" class="text-blue-500 hover:text-blue-700 text-xs font-semibold px-2 py-1 rounded-full border border-blue-200 hover:bg-blue-50 transition">
                                Preview (${data.users})
                            </button>
                        </td>
                    </tr>
                `;
            });
            referralTableBody.innerHTML = html;
        }

        function copyReferralLink() {
            const linkInput = document.getElementById('referralLink');
            linkInput.select();
            document.execCommand('copy');
            showMessage('Success!', 'Your Referral link has been copied to the clipboard.');
        }

        function showLevelUsers(level) {
            const levelData = mockReferralData.find(d => d.level === level);
            if (!levelData) return;

            levelUsersTitle.innerHTML = `<i data-lucide="users" class="w-6 h-6 mr-2 text-blue-500"></i> Users in Level ${level} (${levelData.users}) (‡§≤‡•á‡§µ‡§≤ ${level} ‡§ï‡•á ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ)`;
            
            let listHtml = '';
            if (levelData.usersDetail && levelData.usersDetail.length > 0) {
                listHtml = levelData.usersDetail.map(user => `
                    <div class="p-4 bg-gray-50 rounded-xl shadow-md border border-gray-100">
                        <p class="font-bold text-gray-800">${user.name}</p>
                        <p class="text-sm text-gray-600">Deposit: <span class="font-semibold text-green-600">$${user.deposit.toLocaleString()}</span></p>
                        <p class="text-xs text-gray-500 mt-1">Date: ${user.datetime}</p>
                    </div>
                `).join('');
            } else {
                listHtml = '<p class="text-center text-gray-500 py-4">No detailed user data available for this level.</p>';
            }

            levelUsersList.innerHTML = listHtml;
            lucide.createIcons();
            navigateTo('levelUsersView');
        }


        // --- Render Functions (History Views) ---
        // (Pagination logic is omitted for brevity but should be included in a real implementation)
        
        function renderHeader(viewId) {
            let title = viewTitles[viewId] || 'AiEarn';
            let backButtonHtml = '';
            const headerElement = document.getElementById('header');
            
            if (viewId !== 'dashboardView') {
                // Determine the correct view to go back to
                let backToView = 'dashboardView';
                if (viewId === 'levelUsersView') {
                    backToView = 'referEarnView'; // Go back to Refer & Earn from User List
                } else if (viewId === 'buyTPHistoryView') {
                    backToView = 'buyTPView'; // Go back to Buy TP form from History
                } else if (viewId === 'weekendEarnHistoryView') {
                    backToView = 'weekendEarnView'; // Go back to Weekend Earn form from History
                } else if (['aiTradingStatusView', 'myTradePowerView', 'introductionView', 'withdrawalView', 'dailyEarningHistoryView'].includes(viewId)) {
                    backToView = 'dashboardView'; // Go back to dashboard from feature views
                }
                
                // New: AI/My TP views go back to dashboard
                backButtonHtml = `
                    <button onclick="navigateTo('${backToView}')" class="text-gray-500 hover:text-gray-700 p-1 rounded-full hover:bg-gray-100">
                        <i data-lucide="arrow-left" class="w-6 h-6"></i>
                    </button>
                `;
            } else {
                backButtonHtml = `
                    <button onclick="console.log('Close')" class="text-gray-500 hover:text-gray-700 p-1 rounded-full hover:bg-gray-100">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                `;
            }

            headerElement.innerHTML = `
                <div class="max-w-lg mx-auto flex items-center">
                    ${backButtonHtml}
                    <h1 class="text-xl font-extrabold text-gray-900 ml-3 truncate">${title}</h1>
                </div>
            `;
            lucide.createIcons();
        }

        function renderWithdrawalRow(item) {
            const statusColor = item.status === 'Completed' ? 'text-green-600' : 'text-orange-500';
            const statusIcon = item.status === 'Completed' ? 'check-circle' : 'loader';
            return `
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-3 px-4 text-xs font-medium text-gray-600">${item.date.split(' ')[0]}<span class="block text-gray-400 text-[10px]">${item.date.split(' ')[1]}</span></td>
                    <td class="py-3 px-4 text-sm font-bold text-orange-600 text-right">$${item.amount.toFixed(2)}</td>
                    <td class="py-3 px-4 text-xs text-right">
                        <span class="font-semibold ${statusColor} flex items-center justify-end">
                            <i data-lucide="${statusIcon}" class="w-3 h-3 mr-1"></i> ${item.status}
                        </span>
                        <span class="block text-gray-400 text-[10px] truncate w-24 ml-auto">${item.txnHash.split('...')[0]}...</span>
                    </td>
                </tr>
            `;
        }

        function renderBuyTPRow(item) {
            return `
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-3 px-4 text-xs font-medium text-gray-600">${item.date}</td>
                    <td class="py-3 px-4 text-sm font-bold text-gray-800 text-right">$${item.amount.toFixed(2)}</td>
                    <td class="py-3 px-4 text-xs text-right">
                        <span class="font-bold text-green-600">$${item.dailyEarning}</span>
                        <span class="block text-gray-400 text-[10px]">(${item.label})</span>
                    </td>
                </tr>
            `;
        }

        function renderDailyEarningRow(item) {
            return `
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-3 px-4 text-xs font-medium text-gray-600">${item.date}</td>
                    <td class="py-3 px-4 text-sm font-bold text-green-600 text-right">$${item.amount}</td>
                    <td class="py-3 px-4 text-xs text-right text-gray-700">${item.rate}</td>
                </tr>
            `;
        }

        function renderWeekendEarnRow(item) {
            const statusColor = item.status === 'Completed' ? 'text-green-600' : 'text-orange-500';
            const statusIcon = item.status === 'Completed' ? 'check-circle' : 'loader';
            const totalReturn = item.amount + item.returnAmount;
            return `
                <tr class="border-b border-gray-100 hover:bg-yellow-50">
                    <td class="py-3 px-4 text-xs font-medium text-gray-600">${item.date.split(' ')[0]}<span class="block text-gray-400 text-[10px]">${item.date.split(' ')[1]}</span></td>
                    <td class="py-3 px-4 text-sm font-bold text-yellow-800 text-right">$${item.amount.toFixed(2)}</td>
                    <td class="py-3 px-4 text-xs text-right">
                        <span class="font-bold text-green-600">$${item.returnAmount.toFixed(2)}</span>
                        <span class="block text-gray-400 text-[10px]">(30.0% Profit)</span>
                    </td>
                    <td class="py-3 px-4 text-xs text-center">
                        <span class="font-semibold ${statusColor} flex items-center justify-center">
                            <i data-lucide="${statusIcon}" class="w-3 h-3 mr-1"></i> ${item.status}
                        </span>
                    </td>
                </tr>
            `;
        }

        function renderPaginatedHistory(data, tableBodyId, currentPage, itemsPerPage, renderRowFn, paginationContainerId, viewId, setPageFn) {
            const tableBody = document.getElementById(tableBodyId);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedData = data.slice(startIndex, endIndex);

            tableBody.innerHTML = paginatedData.map(renderRowFn).join('');
            renderPaginationControls(data.length, itemsPerPage, currentPage, viewId, paginationContainerId, setPageFn);
            lucide.createIcons();
        }

        // --- Pagination Logic (Reusable) --- 
        let currentTPHistoryPage = 1;
        let currentWithdrawalPage = 1;
        let currentDailyEarningPage = 1;
        let currentWeekendEarnPage = 1;
        const ITEMS_PER_PAGE = 10;

        // Setters for pagination
        const setTPPage = (page) => { currentTPHistoryPage = page; };
        const setWithdrawalPage = (page) => { currentWithdrawalPage = page; };
        const setDailyPage = (page) => { currentDailyEarningPage = page; };
        const setWeekendEarnPage = (page) => { currentWeekendEarnPage = page; };

        function renderPaginationControls(totalItems, itemsPerPage, currentPage, targetViewId, paginationContainerId, setPageFn) {
            const container = document.getElementById(paginationContainerId);
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            container.innerHTML = '';

            if (totalPages <= 1) return;

            const maxButtons = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
            let endPage = Math.min(totalPages, startPage + maxButtons - 1);

            if (endPage - startPage + 1 < maxButtons) {
                startPage = Math.max(1, endPage - maxButtons + 1);
            }

            // Previous Button
            let prevButton = document.createElement('button');
            prevButton.className = 'pagination-button bg-gray-200 text-gray-700';
            prevButton.disabled = currentPage === 1;
            prevButton.innerHTML = '<i data-lucide="chevron-left" class="w-4 h-4"></i>';
            prevButton.onclick = () => { setPageFn(currentPage - 1); navigateTo(targetViewId); };
            container.appendChild(prevButton);

            // Page Number Buttons
            for (let i = startPage; i <= endPage; i++) {
                let button = document.createElement('button');
                button.className = `pagination-button ${i === currentPage ? 'active' : 'bg-gray-200 text-gray-700'}`;
                button.textContent = i;
                button.onclick = () => { setPageFn(i); navigateTo(targetViewId); };
                container.appendChild(button);
            }

            // Next Button
            let nextButton = document.createElement('button');
            nextButton.className = 'pagination-button bg-gray-200 text-gray-700';
            nextButton.disabled = currentPage === totalPages;
            nextButton.innerHTML = '<i data-lucide="chevron-right" class="w-4 h-4"></i>';
            nextButton.onclick = () => { setPageFn(currentPage + 1); navigateTo(targetViewId); };
            container.appendChild(nextButton);

            lucide.createIcons();
        }

        function renderWithdrawalHistory(page) {
            renderPaginatedHistory(mockWithdrawalHistory, 'withdrawalHistoryBody', page, ITEMS_PER_PAGE, renderWithdrawalRow, 'withdrawalHistoryPagination', 'withdrawalView', setWithdrawalPage);
        }

        function renderBuyTPHistory(page) {
            renderPaginatedHistory(mockBuyTPHistory, 'buyTPHistoryBody', page, ITEMS_PER_PAGE, renderBuyTPRow, 'buyTPHistoryPagination', 'buyTPHistoryView', setTPPage);
        }

        function renderDailyEarningHistory(page) {
            renderPaginatedHistory(mockDailyEarningHistory, 'dailyEarningHistoryBody', page, ITEMS_PER_PAGE, renderDailyEarningRow, 'dailyEarningHistoryPagination', 'dailyEarningHistoryView', setDailyPage);
        }

        function renderWeekendEarnHistory(page) {
            renderPaginatedHistory(mockWeekendEarnHistory, 'weekendEarnHistoryBody', page, ITEMS_PER_PAGE, renderWeekendEarnRow, 'weekendEarnHistoryPagination', 'weekendEarnHistoryView', setWeekendEarnPage);
        }

        function renderAITradingStatus() {
            const body = document.getElementById('aiTradingHistoryBody');
            const html = mockAITradingHistory.map(item => {
                const isProfit = item.profit >= 0;
                const profitColor = isProfit ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700';
                return `
                    <tr class="border-b border-gray-700 hover:bg-gray-800 transition">
                        <td class="py-3 px-2 text-xs font-semibold text-white">
                            <span class="block">${item.pair}</span>
                            <span class="block text-[10px] ${item.position === 'Long' ? 'text-green-400' : 'text-red-400'}">${item.position}</span>
                        </td>
                        <td class="py-3 px-2 text-xs font-semibold text-gray-600">${item.leverage}</td>
                        <td class="py-3 px-2 text-xs text-right">
                            <span class="block font-bold text-gray-800">${item.entry.toFixed(4)}</span>
                            <span class="block text-gray-400 text-[10px]">${item.execute.toFixed(4)}</span>
                        </td>
                        <td class="py-3 px-2 text-xs text-right">
                            <span class="font-extrabold ${profitColor} p-1 rounded-md inline-block">
                                ${isProfit ? '+' : ''}${item.profit.toFixed(2)}%
                            </span>
                        </td>
                        <td class="py-3 px-2 text-xs text-gray-500 w-16">${item.time.split(' ')[1].slice(0, 5)}</td>
                    </tr>
                `;
            }).join('');
            body.innerHTML = html;
        }

        function renderMyTradePower() {
            const list = document.getElementById('myTPPackagesList');
            let html = mockUserTPPackages.map(item => {
                const daysRemaining = item.daysTotal - item.activeDays;
                const percentage = Math.min(100, (item.activeDays / item.daysTotal) * 100);
                const progressColor = percentage < 75 ? 'bg-green-500' : 'bg-red-500';
                const statusLabel = daysRemaining > 0 ? `${daysRemaining} Days Left` : 'Expired!';
                const statusColor = daysRemaining > 0 ? 'text-green-600' : 'text-red-600';
                const cardBorder = daysRemaining > 0 ? 'border-green-300' : 'border-red-300';
                
                // Calculate estimated daily return
                const dailyReturn = (item.amount * item.dailyEarning).toFixed(4);

                return `
                    <div class="bg-white p-5 rounded-2xl shadow-xl border-t-8 ${cardBorder} space-y-3">
                        <div class="flex justify-between items-center border-b pb-3">
                            <h3 class="text-2xl font-extrabold text-gray-800">
                                $${item.amount.toLocaleString()} <span class="text-sm font-medium text-gray-500">TP Package</span>
                            </h3>
                            <span class="font-bold text-lg ${statusColor} bg-gray-100 px-3 py-1 rounded-full">${statusLabel}</span>
                        </div>
                        <div class="flex justify-between text-sm font-medium">
                            <div class="text-center">
                                <p class="text-gray-500">Active Date</p>
                                <p class="font-bold text-gray-700">${item.startDate}</p>
                            </div>
                            <div class="text-center">
                                <p class="text-gray-500">TP Rate</p>
                                <p class="font-bold text-green-600">${(item.dailyEarning * 100).toFixed(1)}%</p>
                            </div>
                            <div class="text-center">
                                <p class="text-gray-500">Daily Est. Earning</p>
                                <p class="font-bold text-green-700">$${dailyReturn}</p>
                            </div>
                        </div>

                        <div class="pt-2">
                            <p class="text-xs text-gray-500 mb-1">Validity Progress: ${item.activeDays}/${item.daysTotal} days</p>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div class="h-2.5 rounded-full ${progressColor}" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            list.innerHTML = html;
        }

        // --- Withdrawal Logic ---
        const withdrawalAmountInput = document.getElementById('withdrawalAmount');
        const walletAddressInput = document.getElementById('walletAddress');

        function simulateWithdrawal() {
            const amount = parseFloat(withdrawalAmountInput.value);
            const address = walletAddressInput.value;
            const minWithdrawal = 20;
            const fee = 5;

            if (isNaN(amount) || amount < minWithdrawal) {
                showMessage('Withdrawal Error', `Minimum withdrawal amount is ${minWithdrawal} USDT.`);
                return;
            }

            if (amount > MOCK_AVAILABLE_BALANCE) {
                showMessage('Withdrawal Error', `Insufficient balance. Available: ${MOCK_AVAILABLE_BALANCE.toFixed(2)} USDT.`);
                return;
            }

            if (address.length < 10) { // Simple mock validation
                showMessage('Withdrawal Error', 'Please enter a valid wallet address.');
                return;
            }

            // Simulate withdrawal
            MOCK_AVAILABLE_BALANCE -= amount;
            MOCK_AVAILABLE_BALANCE -= fee; // Deduct fee
            
            const newWithdrawal = { id: mockWithdrawalHistory.length + 1, amount: amount, date: new Date().toISOString().split('T')[0] + ' ' + new Date().toTimeString().split(' ')[0].slice(0, 5) + ':00', txnHash: 'Processing...', status: 'Processing' };
            mockWithdrawalHistory.unshift(newWithdrawal);
            
            renderWithdrawalHistory(1); // Re-render first page
            withdrawalAmountInput.value = ''; // Clear input

            // Update balance display in withdrawal view
            const balanceSpan = document.querySelector('#withdrawalView .text-3xl.font-extrabold.text-orange-600');
            if (balanceSpan) {
                balanceSpan.textContent = `${MOCK_AVAILABLE_BALANCE.toFixed(2)} USDT`;
            }

            showMessage('Withdrawal Initiated', `Your request for ${amount.toFixed(2)} USDT has been submitted. It is now processing.`);
        }

        // NEW FUNCTION: Auto-invest all available balance to TP
        function reinvestAllBalance() {
            // NOTE: This is a simulation.
            const amount = MOCK_AVAILABLE_BALANCE;
            const minReinvest = 10;
            
            if (amount < minReinvest) {
                showMessage('Re-invest Error', `Minimum re-investment amount is ${minReinvest} USDT. Available: ${amount.toFixed(2)} USDT.`);
                return;
            }

            // 1. Simulate TP purchase logic (get ROI details)
            const roi = getRoiDetails(amount);

            // 2. Simulate adding a new TP package (20-day validity)
            const newTPPackage = {
                id: mockUserTPPackages.length + 101, 
                amount: amount, 
                dailyEarning: roi.rate, 
                activeDays: 0, 
                daysTotal: 20, 
                startDate: new Date().toISOString().split('T')[0], 
                endDate: new Date(new Date().setDate(new Date().getDate() + 20)).toISOString().split('T')[0]
            };
            mockUserTPPackages.push(newTPPackage);
            
            // 3. Reset available balance
            MOCK_AVAILABLE_BALANCE = 0;

            // 4. Update the UI 
            const balanceSpan = document.querySelector('#withdrawalView .text-3xl.font-extrabold.text-orange-600');
            if (balanceSpan) {
                balanceSpan.textContent = `${MOCK_AVAILABLE_BALANCE.toFixed(2)} USDT`;
            }

            showMessage(
                'TP Re-investment Successful', 
                `Successfully re-invested ${amount.toFixed(2)} USDT into Trade Power (TP). Your daily earnings will increase!`
            );
        }


        // Simple message box function instead of alert()
        function showMessage(title, message) {
            const messageBox = document.createElement('div');
            messageBox.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            messageBox.innerHTML = `
                <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full text-center transform scale-95 transition-all duration-300 ease-out animate-in fade-in zoom-in">
                    <h3 class="text-xl font-bold mb-3 text-gray-800">${title}</h3>
                    <p class="text-gray-600 mb-5">${message}</p>
                    <button onclick="this.parentNode.parentNode.remove()" class="bg-blue-600 text-white px-5 py-2 rounded-lg font-semibold hover:bg-blue-700 transition">OK</button>
                </div>
            `;
            document.body.appendChild(messageBox);
        }

        // --- Initialization ---
        window.onload = function() {
            // üü¢ 3. Telegram WebApp ‡§ï‡•ã initialize ‡§ï‡§∞‡•á‡§Ç üü¢
            initializeTelegramWebApp(); 
            
            // Initializing all view elements for navigation logic
            document.querySelectorAll('section[data-view]').forEach(view => {
                views[view.id] = view;
            });
            
            lucide.createIcons();
            // Initial check to set the dashboard button state
            checkWeekendEligibility();
            navigateTo(currentPage); // Initial navigation to dashboardView
        };
    </script>
</body>
</html>
